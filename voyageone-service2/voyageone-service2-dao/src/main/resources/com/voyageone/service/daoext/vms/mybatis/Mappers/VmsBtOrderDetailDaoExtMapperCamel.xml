<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.voyageone.service.daoext.vms.VmsBtOrderDetailDaoExt">
    <resultMap id="BaseResultMap" type="com.voyageone.service.model.vms.VmsBtOrderDetailModel"/>
    <sql id="Base_Column_List">
        `id`, `reservation_id`, `channel_id`, `consolidation_order_id`, `consolidation_order_time`,
        `order_id`, `order_time`, `cart_id`, `client_sku`, `barcode`, `description`, `status`,
        `shipment_id`, `shipment_time`, `containerizing_time`, `containerizer`, `received_time`,
        `receiver`, `client_msrp`, `client_net_price`, `client_retail_price`, `client_promotion_price`,
        `created`, `creater`, `modified`, `modifier`
    </sql>

    <!-- select -->
    <select id="selectListLimitedByTime" parameterType="HashMap" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from vms_bt_order_detail
        <where>
            <if test="reservationId != null">
                and `reservation_id` = #{reservationId,jdbcType=VARCHAR}
            </if>
            <if test="channelId != null">
                and `channel_id` = #{channelId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderId != null">
                and `consolidation_order_id` = #{consolidationOrderId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderTime != null">
                and `consolidation_order_time` = #{consolidationOrderTime,jdbcType=VARCHAR}
            </if>
            <if test="orderId != null">
                and `order_id` = #{orderId,jdbcType=VARCHAR}
            </if>
            <if test="orderTime != null">
                and `order_time` = #{orderTime,jdbcType=VARCHAR}
            </if>
            <if test="cartId != null">
                and `cart_id` = #{cartId,jdbcType=INTEGER}
            </if>
            <if test="sku != null">
                and `client_sku` = #{sku,jdbcType=VARCHAR}
            </if>
            <if test="barcode != null">
                and `barcode` = #{barcode,jdbcType=VARCHAR}
            </if>
            <if test="description != null">
                and `description` = #{description,jdbcType=VARCHAR}
            </if>
            <if test="status != null &amp;&amp; status != 0">
                and `status` = #{status,jdbcType=VARCHAR}
            </if>
            <if test="shipmentId != null">
                and `shipment_id` = #{shipmentId,jdbcType=INTEGER}
            </if>
            <if test="shipmentTime != null">
                and `shipment_time` = #{shipmentTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizingTime != null">
                and `containerizing_time` = #{containerizingTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizer != null">
                and `containerizer` = #{containerizer,jdbcType=VARCHAR}
            </if>
            <if test="receivedTime != null">
                and `received_time` = #{receivedTime,jdbcType=VARCHAR}
            </if>
            <if test="receiver != null">
                and `receiver` = #{receiver,jdbcType=VARCHAR}
            </if>
            <if test="clientMsrp != null">
                and `client_msrp` = #{clientMsrp,jdbcType=DECIMAL}
            </if>
            <if test="clientNetPrice != null">
                and `client_net_price` = #{clientNetPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientRetailPrice != null">
                and `client_retail_price` = #{clientRetailPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientPromotionPrice != null">
                and `client_promotion_price` = #{clientPromotionPrice,jdbcType=DECIMAL}
            </if>
            <if test="created != null">
                and `created` = #{created,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `creater` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="modified != null">
                and `modified` = #{modified,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `modifier` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="orderDateFrom !=null &amp;&amp; orderDateTo != null">
                and `order_time` > #{orderDateFrom} and #{orderDateTo} >= #{orderDateTo}
            </if>
        </where>
    </select>

    <select id="selectList" parameterType="HashMap" resultType="java.lang.String">
        select distinct
        `order_id`
        from vms_bt_order_detail
        <where>
            <if test="reservationId != null">
                and `reservation_id` = #{reservationId,jdbcType=VARCHAR}
            </if>
            <if test="channelId != null">
                and `channel_id` = #{channelId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderId != null">
                and `consolidation_order_id` = #{consolidationOrderId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderTime != null">
                and `consolidation_order_time` = #{consolidationOrderTime,jdbcType=VARCHAR}
            </if>
            <if test="orderId != null">
                and `order_id` = #{orderId,jdbcType=VARCHAR}
            </if>
            <if test="orderTime != null">
                and `order_time` = #{orderTime,jdbcType=VARCHAR}
            </if>
            <if test="cartId != null">
                and `cart_id` = #{cartId,jdbcType=INTEGER}
            </if>
            <if test="sku != null">
                and `client_sku` = #{sku,jdbcType=VARCHAR}
            </if>
            <if test="barcode != null">
                and `barcode` = #{barcode,jdbcType=VARCHAR}
            </if>
            <if test="description != null">
                and `description` = #{description,jdbcType=VARCHAR}
            </if>
            <if test="status != null &amp;&amp; status != 0">
                and `status` = #{status,jdbcType=VARCHAR}
            </if>
            <if test="shipmentId != null">
                and `shipment_id` = #{shipmentId,jdbcType=INTEGER}
            </if>
            <if test="shipmentTime != null">
                and `shipment_time` = #{shipmentTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizingTime != null">
                and `containerizing_time` = #{containerizingTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizer != null">
                and `containerizer` = #{containerizer,jdbcType=VARCHAR}
            </if>
            <if test="receivedTime != null">
                and `received_time` = #{receivedTime,jdbcType=VARCHAR}
            </if>
            <if test="receiver != null">
                and `receiver` = #{receiver,jdbcType=VARCHAR}
            </if>
            <if test="clientMsrp != null">
                and `client_msrp` = #{clientMsrp,jdbcType=DECIMAL}
            </if>
            <if test="clientNetPrice != null">
                and `client_net_price` = #{clientNetPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientRetailPrice != null">
                and `client_retail_price` = #{clientRetailPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientPromotionPrice != null">
                and `client_promotion_price` = #{clientPromotionPrice,jdbcType=DECIMAL}
            </if>
            <if test="created != null">
                and `created` = #{created,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `creater` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="modified != null">
                and `modified` = #{modified,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `modifier` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="orderDateFrom !=null">
                and `order_time` >= #{orderDateFrom}
            </if>
            <if test="orderDateTo != null">
                and #{orderDateTo} > `order_time`
            </if>
        </where>
    </select>

    <select id="selectPlatformOrderListNumLimitedByTime" parameterType="HashMap" resultType="java.lang.Long">
        select count(distinct order_id)
        from vms_bt_order_detail
        <where>
            <if test="reservationId != null">
                and `reservation_id` = #{reservationId,jdbcType=VARCHAR}
            </if>
            <if test="channelId != null">
                and `channel_id` = #{channelId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderId != null">
                and `consolidation_order_id` = #{consolidationOrderId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderTime != null">
                and `consolidation_order_time` = #{consolidationOrderTime,jdbcType=VARCHAR}
            </if>
            <if test="orderId != null">
                and `order_id` = #{orderId,jdbcType=VARCHAR}
            </if>
            <if test="orderTime != null">
                and `order_time` = #{orderTime,jdbcType=VARCHAR}
            </if>
            <if test="cartId != null">
                and `cart_id` = #{cartId,jdbcType=INTEGER}
            </if>
            <if test="sku != null">
                and `client_sku` = #{sku,jdbcType=VARCHAR}
            </if>
            <if test="barcode != null">
                and `barcode` = #{barcode,jdbcType=VARCHAR}
            </if>
            <if test="description != null">
                and `description` = #{description,jdbcType=VARCHAR}
            </if>
            <if test="status != null &amp;&amp; status != 0">
                and `status` = #{status,jdbcType=VARCHAR}
            </if>
            <if test="shipmentId != null">
                and `shipment_id` = #{shipmentId,jdbcType=INTEGER}
            </if>
            <if test="shipmentTime != null">
                and `shipment_time` = #{shipmentTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizingTime != null">
                and `containerizing_time` = #{containerizingTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizer != null">
                and `containerizer` = #{containerizer,jdbcType=VARCHAR}
            </if>
            <if test="receivedTime != null">
                and `received_time` = #{receivedTime,jdbcType=VARCHAR}
            </if>
            <if test="receiver != null">
                and `receiver` = #{receiver,jdbcType=VARCHAR}
            </if>
            <if test="clientMsrp != null">
                and `client_msrp` = #{clientMsrp,jdbcType=DECIMAL}
            </if>
            <if test="clientNetPrice != null">
                and `client_net_price` = #{clientNetPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientRetailPrice != null">
                and `client_retail_price` = #{clientRetailPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientPromotionPrice != null">
                and `client_promotion_price` = #{clientPromotionPrice,jdbcType=DECIMAL}
            </if>
            <if test="created != null">
                and `created` = #{created,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `creater` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="modified != null">
                and `modified` = #{modified,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `modifier` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="orderDateFrom !=null">
                and `order_time` >= #{orderDateFrom}
            </if>
            <if test="orderDateTo != null">
                and #{orderDateTo} > `order_time`
            </if>
        </where>
    </select>

    <select id="selectSkuListNumLimitedByTime" parameterType="HashMap" resultType="java.lang.Long">
        select count(1)
        from vms_bt_order_detail
        <where>
            <if test="reservationId != null">
                and `reservation_id` = #{reservationId,jdbcType=VARCHAR}
            </if>
            <if test="channelId != null">
                and `channel_id` = #{channelId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderId != null">
                and `consolidation_order_id` = #{consolidationOrderId,jdbcType=VARCHAR}
            </if>
            <if test="consolidationOrderTime != null">
                and `consolidation_order_time` = #{consolidationOrderTime,jdbcType=VARCHAR}
            </if>
            <if test="orderId != null">
                and `order_id` = #{orderId,jdbcType=VARCHAR}
            </if>
            <if test="orderTime != null">
                and `order_time` = #{orderTime,jdbcType=VARCHAR}
            </if>
            <if test="cartId != null">
                and `cart_id` = #{cartId,jdbcType=INTEGER}
            </if>
            <if test="sku != null">
                and `client_sku` = #{sku,jdbcType=VARCHAR}
            </if>
            <if test="barcode != null">
                and `barcode` = #{barcode,jdbcType=VARCHAR}
            </if>
            <if test="description != null">
                and `description` = #{description,jdbcType=VARCHAR}
            </if>
            <if test="status != null &amp;&amp; status != 0">
                and `status` = #{status,jdbcType=VARCHAR}
            </if>
            <if test="shipmentId != null">
                and `shipment_id` = #{shipmentId,jdbcType=INTEGER}
            </if>
            <if test="shipmentTime != null">
                and `shipment_time` = #{shipmentTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizingTime != null">
                and `containerizing_time` = #{containerizingTime,jdbcType=VARCHAR}
            </if>
            <if test="containerizer != null">
                and `containerizer` = #{containerizer,jdbcType=VARCHAR}
            </if>
            <if test="receivedTime != null">
                and `received_time` = #{receivedTime,jdbcType=VARCHAR}
            </if>
            <if test="receiver != null">
                and `receiver` = #{receiver,jdbcType=VARCHAR}
            </if>
            <if test="clientMsrp != null">
                and `client_msrp` = #{clientMsrp,jdbcType=DECIMAL}
            </if>
            <if test="clientNetPrice != null">
                and `client_net_price` = #{clientNetPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientRetailPrice != null">
                and `client_retail_price` = #{clientRetailPrice,jdbcType=DECIMAL}
            </if>
            <if test="clientPromotionPrice != null">
                and `client_promotion_price` = #{clientPromotionPrice,jdbcType=DECIMAL}
            </if>
            <if test="created != null">
                and `created` = #{created,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `creater` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="modified != null">
                and `modified` = #{modified,jdbcType=TIMESTAMP}
            </if>
            <if test="creater != null">
                and `modifier` = #{creater,jdbcType=VARCHAR}
            </if>
            <if test="orderDateFrom !=null">
                and `order_time` >= #{orderDateFrom}
            </if>
            <if test="orderDateTo != null">
                and #{orderDateTo} > `order_time`
            </if>
        </where>
    </select>

    <!-- update -->
    <update id="updateOrderStatus" parameterType="HashMap">
        update vms_bt_order_detail set `status` = #{status, jdbcType=VARCHAR}
        <if test="modifier != null">
            , `modifier` = #{modifier, jdbcType=VARCHAR}
        </if>
        where
        <choose>
        <when test="orderId != null">
            `channel_id` = #{channelId, jdbcType=VARCHAR} and `order_id` = #{orderId, jdbcType=VARCHAR}
        </when>
        <when test="reservationId != null">
            `channel_id` = #{channelId, jdbcType=VARCHAR} and `reservation_id` = #{reservationId}
        </when>
        </choose>
    </update>
</mapper>
