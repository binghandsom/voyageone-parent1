<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.voyageone.bi.mapper.IncidentalsMapper">

    <!-- 获得fms_cost_transpotation_incidentals信息结构 -->
    <resultMap id="incidentalsMap" type="bi.IncidentalsBean">
        <result column="seq" property="seq"/>
        <result column="invoice_num" property="invoice_num"/>
        <result column="arrived_time" property="arrived_time"/>
        <result column="process_time" property="process_time"/>
        <result column="main_waybill_num" property="main_waybill_num"/>
        <result column="weight_actual_kg" property="weight_actual_kg"/>
        <result column="weight_calc_kg" property="weight_calc_kg"/>
        <result column="ground_handling_fee" property="ground_handling_fee"/>
        <result column="storage_charges" property="storage_charges"/>
        <result column="amount" property="amount"/>
        <result column="notes" property="notes"/>
        <result column="residence_days" property="residence_days"/>
    </resultMap>

    <!-- 设定fms_cost_transpotation_incidentals检索条件 -->
    <sql id="fms_cost_transpotation_incidentals_condition">
        <where>
            <if test="invoice_num != null and invoice_num != '' ">
                and invoice_num = #{invoice_num}
            </if>
            <if test="main_waybill_num != null and main_waybill_num != '' ">
                and main_waybill_num = #{main_waybill_num}
            </if>
            <if test="storage_charges != null and storage_charges != '' ">
                and storage_charges > #{storage_charges}
            </if>
            <if test="arrived_time_from != null and arrived_time_from != '' ">
                and arrived_time <![CDATA[=>]]> convert(#{arrived_time_from}, datetime)
            </if>
            <if test="arrived_time_to != null and arrived_time_to != '' ">
                and arrived_time  <![CDATA[<=]]> convert(#{arrived_time_to}, datetime)
            </if>
            <if test="process_time_from != null and process_time_from != '' ">
                and process_time <![CDATA[=>]]> convert(#{process_time_from}, datetime)
            </if>
            <if test="process_time_to != null and process_time_to != '' ">
                and process_time  <![CDATA[<=]]> convert(#{process_time_to}, datetime)
            </if>
        </where>
    </sql>

    <sql id="fms_cost_transpotation_incidentals_condition_fuzzy">
        <where>
            <if test="invoice_num != null and invoice_num != '' ">
                and invoice_num LIKE CONCAT('%',#{invoice_num},'%' )
            </if>
            <if test="main_waybill_num != null and main_waybill_num != '' ">
                and main_waybill_num LIKE CONCAT('%',#{main_waybill_num},'%' )
            </if>
            <if test="storage_charges != null and storage_charges != '' ">
                and storage_charges <![CDATA[>]]> #{storage_charges}
            </if>
            <if test="arrived_time_from != null and arrived_time_from != '' ">
                and arrived_time <![CDATA[=>]]> convert(#{arrived_time_from}, datetime)
            </if>
            <if test="arrived_time_to != null and arrived_time_to != '' ">
                and arrived_time  <![CDATA[<=]]> convert(#{arrived_time_to}, datetime)
            </if>
            <if test="process_time_from != null and process_time_from != '' ">
                and process_time <![CDATA[=>]]> convert(#{process_time_from}, datetime)
            </if>
            <if test="process_time_to != null and process_time_to != '' ">
                and process_time  <![CDATA[<=]]> convert(#{process_time_to}, datetime)
            </if>
        </where>
    </sql>

    <!-- 获得fms_cost_transpotation_incidentals数量 -->
    <select id="select_count_fms_cost_transpotation_incidentals" parameterType="Map" resultType="int">
        select
        count(1)
        from bi_source.fms_cost_transpotation_incidentals
        <include refid="fms_cost_transpotation_incidentals_condition"/>
    </select>

    <select id="select_record_fms_cost_transpotation_incidentals" parameterType="Map"
            resultMap="incidentalsMap">
        SELECT
        seq,
        invoice_num,
        arrived_time,
        process_time,
        main_waybill_num,
        weight_actual_kg,
        weight_calc_kg,
        ground_handling_fee,
        storage_charges,
        amount,
        notes,
        residence_days
        FROM bi_source.fms_cost_transpotation_incidentals
        <include refid="fms_cost_transpotation_incidentals_condition"/>
        LIMIT 1
    </select>

    <!-- 检索fms_cost_transpotation_incidentals信息 -->
    <select id="select_list_fms_cost_transpotation_incidentals" parameterType="Map" resultMap="incidentalsMap">
        SELECT
        seq,
        invoice_num,
        arrived_time,
        process_time,
        main_waybill_num,
        weight_actual_kg,
        weight_calc_kg,
        ground_handling_fee,
        storage_charges,
        amount,
        notes,
        residence_days
        FROM bi_source.fms_cost_transpotation_incidentals
        <include refid="fms_cost_transpotation_incidentals_condition_fuzzy"/>
        ORDER BY
        invoice_num,
        seq
        <if test="init_index != null and init_index != '' and get_size != null and get_size != ''">
            LIMIT #{init_index}, #{get_size}
        </if>
    </select>

    <insert id="insert_fms_cost_transpotation_incidentals" parameterType="Map">
        INSERT INTO bi_source.fms_cost_transpotation_incidentals (
        seq,
        invoice_num,
        arrived_time,
        process_time,
        main_waybill_num,
        weight_actual_kg,
        weight_calc_kg,
        ground_handling_fee,
        storage_charges,
        amount,
        notes,
        residence_days
        )
        VALUES
        (
        NULL,
        &apos;${IncidentalsBean.invoice_num}&apos;,
        STR_To_DATE(&apos;${IncidentalsBean.arrived_time}&apos;,'%a %b %d %H:%i:%s CST %Y'),
        STR_To_DATE(&apos;${IncidentalsBean.process_time}&apos;,'%a %b %d %H:%i:%s CST %Y'),
        &apos;${IncidentalsBean.main_waybill_num}&apos;,
        &apos;${IncidentalsBean.weight_actual_kg}&apos;,
        &apos;${IncidentalsBean.weight_calc_kg}&apos;,
        &apos;${IncidentalsBean.ground_handling_fee}&apos;,
        &apos;${IncidentalsBean.storage_charges}&apos;,
        &apos;${IncidentalsBean.amount}&apos;,
        &apos;${IncidentalsBean.notes}&apos;,
        &apos;${IncidentalsBean.residence_days}&apos;
        )
    </insert>

    <insert id="insert_list_fms_cost_transpotation_incidentals" parameterType="Map" useGeneratedKeys="true">
        INSERT INTO bi_source.fms_cost_transpotation_incidentals
        <foreach collection="column" index="index" item="columnname" open="(" separator="," close=")">
            ${columnname}
        </foreach>
        VALUES
        <foreach collection="value" index="index" item="IncidentalsBean" separator=",">
            (
            NULL,
            &apos;${IncidentalsBean.invoice_num}&apos;,
            STR_To_DATE(&apos;${IncidentalsBean.arrived_time}&apos;,'%Y-%m-%d'),
            STR_To_DATE(&apos;${IncidentalsBean.process_time}&apos;,'%Y-%m-%d'),
            &apos;${IncidentalsBean.main_waybill_num}&apos;,
            &apos;${IncidentalsBean.weight_actual_kg}&apos;,
            &apos;${IncidentalsBean.weight_calc_kg}&apos;,
            &apos;${IncidentalsBean.ground_handling_fee}&apos;,
            &apos;${IncidentalsBean.storage_charges}&apos;,
            &apos;${IncidentalsBean.amount}&apos;,
            &apos;${IncidentalsBean.notes}&apos;,
            &apos;${IncidentalsBean.residence_days}&apos;
            )
        </foreach>
    </insert>

    <!-- 检索fms_cost_transpotation_incidentals信息 -->
    <delete id="delete_fms_cost_transpotation_incidentals" parameterType="Map">
        DELETE FROM bi_source.fms_cost_transpotation_incidentals
        <include refid="fms_cost_transpotation_incidentals_condition"/>
    </delete>

    <update id="update_fms_cost_transpotation_incidentals" parameterType="Map">
        UPDATE bi_source.fms_cost_transpotation_incidentals
        SET
        invoice_num = &apos;${IncidentalsBean.invoice_num}&apos;,'%Y-%m-%d'),
        process_time = STR_To_DATE(&apos;${IncidentalsBean.process_time}&apos;,'%Y-%m-%d'),
        main_waybill_num = &apos;${IncidentalsBean.main_waybill_num}&apos;,
        weight_actual_kg = &apos;${IncidentalsBean.weight_actual_kg}&apos;,
        weight_calc_kg = &apos;${IncidentalsBean.weight_calc_kg}&apos;,
        ground_handling_fee = &apos;${IncidentalsBean.ground_handling_fee}&apos;,
        storage_charges = &apos;${IncidentalsBean.storage_charges}&apos;,
        amount = &apos;${IncidentalsBean.amount}&apos;,
        notes = &apos;${IncidentalsBean.notes}&apos;,
        residence_days = &apos;${IncidentalsBean.residence_days}&apos;
        <include refid="fms_cost_transpotation_incidentals_condition"/>
    </update>
</mapper>
