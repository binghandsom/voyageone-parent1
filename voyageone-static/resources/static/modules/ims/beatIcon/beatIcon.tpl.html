<div class="panel" ng-controller="BeatController as ctrl">
    <!--0.2.1-->
    <div class="panel-body">
        <fieldset>
            <legend>价格披露任务：</legend>
            <div class="row">
                <div class="col-sm-4">
                    <ui-select ng-model="ctrl.selected.channel" on-select="ctrl.changeChannel()">
                        <ui-select-match placeholder="Please select a Channel">{{$select.selected.name}}
                        </ui-select-match>
                        <ui-select-choices repeat="i.id as i in ctrl.channels | filter: $select.search">
                            <div ng-bind-html="i.name"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <br/>
            <div class="row">
                <div class="col-sm-2">
                    <button class="btn btn-primary btn-sm" ng-click="ctrl.createBeat()">
                        新建任务
                    </button>
                </div>
            </div>
        </fieldset>
        <p>
            <button ng-click="ctrl.reloadData(0)" type="button" class="btn btn-info">
                <i class="fa fa-refresh"></i>&nbsp;Reload data
            </button>
        </p>
        <table datatable dt-options="ctrl.dtBeats.options" dt-columns="ctrl.dtBeats.columns"
               dt-instance="ctrl.dtBeats.instance"
               class="table table-striped table-bordered table-hover table-condensed"></table>
        <br/>
        <div class="form-inline">
            <div class="form-group">
                <div class="btn-group">
                    <label class="btn btn-success" ng-model="ctrl.itemsType" btn-radio="true" uncheckable>Code</label>
                    <label class="btn btn-success" ng-model="ctrl.itemsType" btn-radio="false" uncheckable>Num iid</label>
                </div>
            </div>

            <input filestyle type="file" data-button-text="Choose file"
                   data-class-button="btn btn-default" data-classinput="form-control inline"
                   nv-file-select uploader="ctrl.itemUploader" tabindex="-1"/>
            <button class="btn btn-info btn-sm" ng-click="ctrl.uploadItems()">提交商品表</button>

            <button class="btn btn-info btn-sm" ng-click="ctrl.downBeatIconExcel()">
                下载并填写价格表
            </button>

            <button class="btn btn-info btn-sm" ng-click="ctrl.downErrExcel('A')">
                下载错误表 A
            </button>

            <input filestyle type="file" data-button-text="Choose file"
                   data-class-button="btn btn-default" data-classinput="form-control inline"
                   nv-file-select uploader="ctrl.priceUploader" tabindex="-1"/>
            <button class="btn btn-warning btn-sm" ng-click="ctrl.uploadPrice()">提交价格表</button>

            <button class="btn btn-info btn-sm" ng-click="ctrl.downErrExcel('B')">
                下载错误表 B
            </button>
        </div>
        <br />
        <div class="form-inline">
            <button class="btn btn-primary btn-sm" ng-click="ctrl.beatControl('startup')">
                启动所有任务
            </button>
            <button class="btn btn-warning btn-sm" ng-click="ctrl.beatControl('cancel')">
                取消所有任务
            </button>
            <button class="btn btn-danger btn-sm" ng-click="ctrl.beatControl('redo')">
                重刷所有任务
            </button>
            <button class="btn btn-danger btn-sm" ng-click="ctrl.beatControl('stop')">
                停止所有任务
            </button>
        </div>
        <div class="hidden">
            <form id="beat-downloadForm" method="post" target="beat-downloadHelper">
                <input type="hidden" name="beat_id" id="beat_id" value="{{ctrl.beat.beat_id}}"/>
                <input type="hidden" name="errLev" id="errLev"/>
            </form>
            <iframe id="beat-downloadHelper" name="beat-downloadHelper"></iframe>
        </div>
        <br/>
        <div class="btn-group">
            <button class="btn btn-default btn-sm" ng-click="ctrl.selected.flg = null">
                筛选所有
            </button>
            <button class="btn btn-default btn-sm" ng-repeat="info in ctrl.beatSummary" ng-click="ctrl.selected.flg = info.flgValue">
                {{ info.cnName + ":" + info.count }}
            </button>
        </div>
        <br/>
        <br/>
        <p>
            <button ng-click="ctrl.reloadData(1)" type="button" class="btn btn-info">
                <i class="fa fa-refresh"></i>&nbsp;Reload data
            </button>
            <button class="btn btn-info" ng-click="ctrl.downErrExcel('C')">
                下载信息表 C
            </button>
        </p>
        <table datatable dt-options="ctrl.dtItems.options" dt-columns="ctrl.dtItems.columns"
               dt-instance="ctrl.dtItems.instance"
               class="table table-striped table-bordered table-hover table-condensed"></table>
    </div>
    <script type="text/ng-template" id="createBeat.tpl.html">
        <div class="modal-header">
            <span class="h4">新建任务</span>
        </div>
        <div class="modal-body">
            <ui-select ng-model="ctrl.beat.cart_id">
                <ui-select-match placeholder="Please select a Cart">{{$select.selected.shop_name}}</ui-select-match>
                <ui-select-choices repeat="i.cart_id as i in ctrl.carts | filter: $select.search">
                    <div ng-bind-html="'[' + i.comment + '] ' + i.shop_name"></div>
                </ui-select-choices>
            </ui-select>
            <br />
            <input type="text" class="form-control" placeholder="Description" ng-model="ctrl.beat.description"/>
            <br />
            <input type="text" class="form-control" placeholder="Image Template Url" ng-model="ctrl.beat.template_url"/>
            <br />
            <div class="row beat-date">
                <div class="col-xs-8">
                    <input ng-model="ctrl.beat.end" type="text" class="form-control" is-open="$$endPicker"
                           datepicker-popup="yyyy-MM-dd" ng-click="$$endPicker = true"/>
                </div>
                <div class="col-xs-4">
                    <timepicker ng-model="ctrl.time.end" hour-step="1" minute-step="1"></timepicker>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="ctrl.ok()">确定</button>
            <button class="btn btn-default" ng-click="ctrl.cancel()">取消</button>
        </div>
    </script>
    <script type="text/ng-template" id="setPrice.tpl.html">
        <div class="modal-header">
            <span class="h4">修改价格</span>
        </div>
        <div class="modal-body">
            <div class="alert alert-danger" ng-show="ctrl.message">{{ctrl.message}}</div>
            <input type="text" class="form-control" placeholder="New price" ng-model="ctrl.price"/>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="ctrl.ok()">确定</button>
            <button class="btn btn-default" ng-click="ctrl.cancel()">取消</button>
        </div>
    </script>
    <script type="text/ng-template" id="progress.tpl.html">
        <div class="modal-header">
            <span class="h4">上传进度</span>
        </div>
        <div class="modal-body">
            <div class="progress" style="">
                <div class="progress-bar" role="progressbar" ng-style="{ 'width': ctrl.uploader.progress + '%' }"></div>
            </div>
        </div>
    </script>
</div>