"use strict";function $Ajax($http,blockUI,$q){this.$http=$http,this.blockUI=blockUI,this.$q=$q}function AjaxService($q,$ajax,messageService){this.$q=$q,this.$ajax=$ajax,this.messageService=messageService}function makeProps(key){return function(val){return 1===arguments.length?this.set(key,val):arguments.length>1?this.set(key,arguments):this.get(key)}}function Cookie(key,value){this.key=key,this.value=value}function CookieService($cookies){this.$cookies=$cookies}function MessageService(alert,confirm,notify){this.alert=alert,this.confirm=confirm,this.notify=notify}function PermissionService($rootScope){this.$rootScope=$rootScope,this.permissions=[]}function TranslateService($translate){this.$translate=$translate}angular.module("voyageone.angular.controllers",[]),angular.module("voyageone.angular.directives",[]),angular.module("voyageone.angular.factories",[]),angular.module("voyageone.angular.services",[]),angular.module("voyageone.angular",["voyageone.angular.controllers","voyageone.angular.directives","voyageone.angular.factories","voyageone.angular.services"]),angular.module("voyageone.angular.controllers").controller("selectRowsCtrl",function($scope){function selectAll(objectList,id){objectList.selAllFlag=!objectList.selAllFlag,id||(id="id"),angular.forEach(objectList.currPageRows,function(object){if(objectList.selFlag[object[id]]=objectList.selAllFlag,objectList.hasOwnProperty("selList")){var tempList=_.pluck(objectList.selList,id);objectList.selAllFlag&&tempList.indexOf(object[id])<0?objectList.selList.push(object):!objectList.selAllFlag&&tempList.indexOf(object[id])>-1&&objectList.selList.splice(tempList.indexOf(object[id]),1)}})}function selectOne(currentId,objectList,id){id||(id="id"),objectList.hasOwnProperty("selList")&&angular.forEach(objectList.currPageRows,function(object){var tempList=_.pluck(objectList.selList,id);_.isEqual(object[id],currentId)&&(tempList.indexOf(object[id])>-1?objectList.selList.splice(tempList.indexOf(object[id]),1):objectList.selList.push(object))}),objectList.selAllFlag=!0,tempList=_.pluck(objectList.selList,id),angular.forEach(objectList.currPageRows,function(object){tempList.indexOf(object[id])==-1&&(objectList.selAllFlag=!1)})}function isAllSelected(objectList,id){if(id||(id="id"),void 0!=objectList){objectList.selAllFlag=!0;var tempList=_.pluck(objectList.selList,id);return angular.forEach(objectList.currPageRows,function(object){tempList.indexOf(object[id])==-1&&(objectList.selAllFlag=!1)}),objectList.selAllFlag}return!1}$scope.selectAll=selectAll,$scope.selectOne=selectOne,$scope.isAllSelected=isAllSelected}),angular.module("voyageone.angular.controllers").controller("showPopoverCtrl",function($scope){function showInfo(values){if(void 0==values||""==values)return"";var tempHtml="";return values instanceof Array?angular.forEach(values,function(data,index){tempHtml+=data,index!==values.length&&(tempHtml+="<br>")}):tempHtml+=values,tempHtml}$scope.showInfo=showInfo}),function(){function sizeof(str){var regex=str.match(/[^\x00-\xff]/g);return str.length+(regex?regex.length:0)}function getByteLength(str){return sizeof(str)}function makeByteLength(attrName,checkLength){return function(){return{restrict:"A",require:"ngModel",scope:!1,link:function(scope,element,attrs,ngModelController){var length=attrs[attrName];length&&ngModelController.$parsers.push(function(viewValue){return ngModelController.$setValidity(attrName,checkLength(getByteLength(viewValue),length)),viewValue})}}}}angular.module("voyageone.angular.directives").directive("maxbytelength",makeByteLength("maxbytelength",function(byteLength,maxLength){return byteLength<=maxLength})).directive("minbytelength",makeByteLength("minbytelength",function(byteLength,minLength){return byteLength>=minLength}))}(),angular.module("voyageone.angular.directives").directive("dateModelFormat",function($filter){return{restrict:"A",require:"ngModel",link:function(scope,elem,attrs,ngModel){ngModel.$parsers.push(function(viewValue){return $filter("date")(viewValue,attrs.dateModelFormat||"yyyy-MM-dd HH:mm:ss")})}}}),angular.module("voyageone.angular.directives").directive("enterClick",function(){return{restrict:"A",link:function(scope,elem,attr){angular.element(elem).on("keyup",function(e){if(13===e.keyCode){var targetElem,selectExp=attr.enterClick,handler=function(){targetElem.triggerHandler("click")};try{targetElem=document.querySelector(selectExp)}catch(e){targetElem=null}if(targetElem){if(targetElem=angular.element(targetElem),targetElem.attr("disabled"))return}else handler=function(){scope.$eval(selectExp)};handler()}})}}}),angular.module("voyageone.angular.directives").directive("fileStyle",function(){function FileStyleController($scope,$element){this.scope=$scope,this.element=$element}return FileStyleController.prototype.init=function(attrs){var options;null!=attrs.fileStyle&&""!=attrs.fileStyle&&(options=eval("("+attrs.fileStyle+")")),this.element.filestyle(options)},{restrict:"A",scope:!0,controller:FileStyleController,controllerAs:"styleCtrl",link:function($scope,$element,$attrs){$scope.styleCtrl.init($attrs)}}}),angular.module("voyageone.angular.directives").directive("goTop",function(){return{restrict:"A",link:function(scope,element,attrs){var speed=+attrs.goTop;$(element).on("click",function(){return $("body").animate({scrollTop:0},speed),!1})}}}),angular.module("voyageone.angular.directives").directive("ifNoRows",function($templateCache,$compile){var tempNoDataKey="voyageone.angular.directives.ifNoRows.tpl.html";return $templateCache.get(tempNoDataKey)||$templateCache.put(tempNoDataKey,'<div class="text-center text-hs" id="noData"><h4 class="text-vo"><i class="icon fa fa-warning"></i>&nbsp;<span translate="TXT_ALERT"></span></h4><span translate="TXT_MSG_NO_DATE"></span></dv>'),{restrict:"A",replace:!1,scope:{$$data:"@ifNoRows"},link:function(scope,element){scope.$parent.$watch(scope.$$data,function(){0==scope.$parent.$eval(scope.$$data)?(element.find("#noData").remove(),element.append($compile($templateCache.get(tempNoDataKey))(scope))):element.find("#noData").remove()})}}}),angular.module("voyageone.angular.directives").directive("image",function(){return{restrict:"A",scope:{image:"@"},link:function(scope,element,attrs){attrs.$observe("image",function(){null!=scope.image&&""!=scope.image&&void 0!=scope.$root.imageUrl&&(element[0].src=scope.$root.imageUrl.replace("%s",scope.image))})}}}),angular.module("voyageone.angular.directives").directive("input",function(){return{restrict:"E",require:["?ngModel"],link:function(scope,element,attr){var type=attr.type;type&&(type=type.toLowerCase(),"number"===type&&element.on("keypress",function(event){var charCode=event.charCode,lastInputIsPoint=element.data("lastInputIsPoint");return 0!==charCode&&46!==charCode&&(charCode<48||charCode>57)?void event.preventDefault():46===charCode?lastInputIsPoint||this.value.indexOf(".")>-1?void event.preventDefault():void element.data("lastInputIsPoint",!0):void element.data("lastInputIsPoint",!1)}))}}}).directive("scale",function(){return{restrict:"A",require:["ngModel"],link:function(scope,element,attr,ctrls){var type=attr.type,ngModelController=ctrls[0];if(type&&(type=type.toLowerCase(),"number"===type)){var scale=attr.scale?+attr.scale:2;element.on("keyup",function(){var regex=new RegExp("^\\d+(\\.\\d{1,"+scale+"})?$");regex.test(this.value)||(ngModelController.$setViewValue(this.value.substr(0,this.value.length-1)),ngModelController.$render())})}}}});var errorTypes={email:"INVALID_EMAIL",url:"INVALID_URL",date:"INVALID_DATE",datetimelocal:"INVALID_DATETIMELOCAL",color:"INVALID_COLOR",range:"INVALID_RANGE",month:"INVALID_MONTH",time:"INVALID_TIME",week:"INVALID_WEEK",number:"INVALID_NUMBER",required:"INVALID_REQUIRED",maxlength:"INVALID_MAXLENGTH",minlength:"INVALID_MINLENGTH",minbytelength:"INVALID_MINLENGTH",maxbytelength:"INVALID_MAXLENGTH",max:"INVALID_MAX",min:"INVALID_MIN",pattern:"INVALID_PATTERN"};angular.module("voyageone.angular.directives").directive("voMessage",function($translate){return{restrict:"E",template:"{{$message}}",require:"^^form",scope:{target:"="},link:function(scope,elem,attrs,formController){function show(message){scope.$message=message,elem.fadeIn()}function hide(){elem.fadeOut()}var formName;elem.hide(),formName=formController.$name,scope.$watch("target.$error",function($error){if($error){var errorKeys=Object.keys($error),elementName=scope.target.$name,targetElement=$('[name="'+formName+'"] [name="'+elementName+'"]'),translateParam={field:targetElement.attr("title")||elementName},error=errorKeys[0];if(!error)return void hide();["maxlength","minlength","maxbytelength","minbytelength","max","min","pattern"].indexOf(error)>-1&&(translateParam.value=targetElement.attr(error)),$translate(errorTypes[error],translateParam).then(show,show)}},!0)}}}),angular.module("voyageone.angular.directives").directive("uiNav",function(){return{restrict:"AC",link:function(scope,el){var next,_window=$(window),_mb=768,wrap=$(".app-aside"),backdrop=".dropdown-backdrop";el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active"),_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault(),_this.next().is("ul")||_window.width()<_mb&&$(".app-aside").removeClass("show off-screen")}),el.on("mouseenter","a",function(e){if(next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<_mb||$(".app-aside-dock").length)){var top,_this=$(e.target),w_h=$(window).height(),offset=50,min=150;!_this.is("a")&&(_this=_this.closest("a")),_this.next().is("ul")&&(next=_this.next(),_this.parent().addClass("active"),top=_this.parent().position().top+offset,next.css("top",top),top+next.height()>w_h&&next.css("bottom",0),top+min>w_h&&next.css("bottom",w_h-top-offset).css("top","auto"),next.appendTo(wrap),next.on("mouseleave.nav",function(e){$(backdrop).remove(),next.appendTo(_this.parent()),next.off("mouseleave.nav").css("top","auto").css("bottom","auto"),_this.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")}))}}),wrap.on("mouseleave",function(e){next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove()})}}}),angular.module("voyageone.angular.directives").directive("ngThumb",["$window",function($window){var helper={support:!(!$window.FileReader||!$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){var type="|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}};return{restrict:"A",link:function(scope,element,attributes){if(helper.support){var params=scope.$eval(attributes.ngThumb);if(helper.isImage(params.file)){var fileReader=new FileReader;fileReader.readAsDataURL(params.file),fileReader.onload=function(event){scope.$apply(function(){attributes.$set("src",event.target.result)})}}}}}}]),angular.module("voyageone.angular.directives").directive("platformStatus",function(){function StatusController($scope,$attrs){this.$attrs=$attrs,this.$scope=$scope,this.statusData=null}return StatusController.prototype.init=function(){if(this.statusData=this.$scope.data,this.statusData&&(this.statusData.pPublishError&&(this.statusData.pStatus="Error"),this.statusData.numberId))switch(+this.statusData.cartId){case 23:this.statusData.detailUrl="https://detail.tmall.hk/hk/item.htm?id="+this.statusData.numberId;break;case 26:this.statusData.detailUrl="http://ware.shop.jd.com/onSaleWare/onSaleWare_viewProduct.action?wareId="+this.statusData.numberId;break;case 27:this.statusData.detailUrl="http://item.jumeiglobal.com/"+this.statusData.numberId+".html";break;case 28:this.statusData.detailUrl="http://ware.shop.jd.com/onSaleWare/onSaleWare_viewProduct.action?wareId="+this.statusData.numberId;break;case 29:this.statusData.detailUrl="http://ware.shop.jd.com/onSaleWare/onSaleWare_viewProduct.action?wareId="+this.statusData.numberId}},{restrict:"E",scope:{data:"=data"},controller:StatusController,controllerAs:"ctrl",template:"<span class='plateform-status' ng-if='ctrl.statusData.status != \"Approved\"'><span class='label' ng-class='{\"pending\": ctrl.statusData.status == \"Pending\",\"ready\":ctrl.statusData.status == \"Ready\" }' title='{{ctrl.statusData.status}}'><span style='color:black'>{{ctrl.statusData.cartName}}</span></span></span><span class='plateform-status' ng-if='ctrl.statusData.status == \"Approved\"'><span class='label' ng-class='{\"waiting-publish\": ctrl.statusData.pStatus == \"WaitingPublish\",\"in-stock\": ctrl.statusData.pStatus == \"InStock\",\"on-sale\":ctrl.statusData.pStatus == \"OnSale\",\"error\":ctrl.statusData.pStatus == \"Error\"}'  title='{{ctrl.statusData.pStatus}}'><span ng-if='ctrl.statusData.numberId'><a ng-href='{{ctrl.statusData.detailUrl}}' target='_blank' style='color: #000;text-decoration: none;'>{{ctrl.statusData.cartName}}</a></span><span ng-if='!ctrl.statusData.numberId'>{{ctrl.statusData.cartName}}</span></span></span>",link:function($scope){$scope.ctrl.init()}}}),angular.module("voyageone.angular.directives").directive("popoverText",function(){return{restrict:"AE",transclude:!0,template:'<small popover-html="content" popover-placement="{{::direct}}"><div class="table_main"><ul><li></li></ul></div></small>',replace:!0,scope:{content:"=content",direct:"@direct",size:"@size"},link:function(scope,element){var content=scope.content,size=scope.size,li=$(element).find("li");content.length>scope.size?li.html(content.substr(0,size)+"...").css({cursor:"default"}):li.html(content)}}}),function(){function random(length){return Math.random().toString().substr(2,length||6)}function getFieldId(field){return field.$schema||(field.$schema={id:field.id.replace(/->/g,".")}),field.$schema.id}function searchField(fieldId,schema){var result=null;return find(schema,function(field){return getFieldId(field)===fieldId?(result=field,!0):!!(field.fields&&field.fields.length&&(result=searchField(fieldId,field.fields)))}),result}function getDependExpressList(rule){var depends=rule.dependGroup;return depends?depends.dependExpressList:null}function hasDepend(rule){var dependExpressList=getDependExpressList(rule);return!!dependExpressList&&!!dependExpressList.length}function getRules(field,schema){var withSchema=!!schema,rules=field.$rules;if(rules){if(!withSchema||rules.$withSchema)return rules}else rules={};return field&&field.rules&&field.rules.length?(each(field.rules,function(rule){if(hasDepend(rule))schema&&(rules[rule.name]=new DependentRule(rule,field,schema));else{var newRule;if("false"===rule.value)return;newRule={},newRule.__proto__=rule,"true"===rule.value?newRule.value=!0:/^-?\d+(\.\d+)?$/.test(rule.value)&&(newRule.value=parseFloat(rule.value)),rules[rule.name]=newRule}}),rules.$withSchema=withSchema,field.$rules=rules,rules):rules}function hasValidateRule(field){return!(!field||!field.rules)&&(!!field.rules.length&&any(field.rules,function(rule){return"valueTypeRule"===rule.name&&rule.value!==VALUE_TYPES.TEXT&&rule.value!==VALUE_TYPES.TEXTAREA&&rule.value!==VALUE_TYPES.HTML||"tipRule"!==rule.name&&"devTipRule"!==rule.name&&"disableRule"!==rule.name}))}function getInputType(valueTypeRule){var type="text";if(!valueTypeRule)return type;switch(valueTypeRule.value){case VALUE_TYPES.TEXT:type="text";break;case VALUE_TYPES.HTML:case VALUE_TYPES.TEXTAREA:type="textarea";break;case VALUE_TYPES.INTEGER:case VALUE_TYPES.LONG:type="number";break;case VALUE_TYPES.DECIMAL:type="number";break;case VALUE_TYPES.DATE:type="date";break;case VALUE_TYPES.TIME:type="datetime-local";break;case VALUE_TYPES.URL:type="url"}return type}function getInputValue(value,field,valueTypeRule){var parsedValue=null,valueType=field.fieldValueType;if(!exists(value))return null;switch(valueType){case"INT":case"DOUBLE":return parsedValue=parseFloat(value),isNaN(parsedValue)?null:parsedValue}if(!valueTypeRule)return value;switch(valueTypeRule.value){case VALUE_TYPES.TEXT:case VALUE_TYPES.HTML:case VALUE_TYPES.TEXTAREA:case VALUE_TYPES.URL:return value;case VALUE_TYPES.INTEGER:case VALUE_TYPES.LONG:case VALUE_TYPES.DECIMAL:return parsedValue=parseFloat(value),isNaN(parsedValue)?null:parsedValue;case VALUE_TYPES.DATE:case VALUE_TYPES.TIME:if(!value)return null;if(parsedValue=new Date(value),isNaN(parsedValue.getDate()))throw"日期(时间)格式不正确";return parsedValue}return value}function bindLengthRule(element,rule,name,attr,ngAttr){rule&&(rule instanceof DependentRule?element.attr(ngAttr||"ng-"+attr,"rules."+name+".getLength()"):element.attr(attr,rule.value))}function bindInputLengthRule(element,rules){var minRule=rules.minLengthRule,maxRule=rules.maxLengthRule;minRule&&(isByteUnit(minRule)?bindLengthRule(element,minRule,"minLengthRule","minbytelength","minbytelength"):bindLengthRule(element,minRule,"minLengthRule","minlength")),maxRule&&(isByteUnit(maxRule)?bindLengthRule(element,maxRule,"maxLengthRule","maxbytelength","maxbytelength"):bindLengthRule(element,maxRule,"maxLengthRule","maxlength"))}function bindBoolRule(element,rule,name,attr){rule&&(rule instanceof DependentRule?element.attr("ng-"+attr,"rules."+name+".checked()"):rule&&element.attr(attr,!0))}function bindTipRule(container,rules){each(rules,function(content,key){if(0!==key.indexOf("$")&&!(key.indexOf("Rule")>0&&"tipRule"!==key)){var contentContainer=angular.element("<s-tip>");if(container.append(contentContainer),"url"in content&&content.url){var aTag=angular.element('<a href="'+content.url+'" target="_blank">');aTag.text(content.value),contentContainer.append(aTag)}else contentContainer.text(content.value)}})}function bindDefaultValueTip(container,field){function tryGetDefault(defaultPropName){var value=field[defaultPropName];return defaultPropName in field&&exists(value)?value:null}var options=field.options,result=tryGetDefault("defaultValue");if(exists(result)||(result=tryGetDefault("defaultValues"),exists(result)&&result.length)){exists(options)&&options.length&&(result=is.array(result)?result.map(function(r){return find(options,function(o){return o.value==r}).displayName}):find(options,function(o){return o.value==result}).displayName);var contentContainer=angular.element("<s-tip>");contentContainer.text("该字段包含默认值: "+angular.toJson(result)),container.append(contentContainer)}}function resetValue(valueObj,fieldObj){["value","values","complexValue","complexValues"].some(function(key){return key in valueObj&&(fieldObj[key]=valueObj[key],!0)})}function isByteUnit(rule){return"byte"===rule.unit}function switchPrivateValue(field,valueKeys,fromPrivate){return field.type===FIELD_TYPES.COMPLEX?void each(field.fields,function(childField){switchPrivateValue(childField,valueKeys,fromPrivate)}):void(fromPrivate?any(valueKeys,function(key){var privateKey="$"+key,privateValueObj=field[privateKey];return privateKey in field&&(exists(privateValueObj)&&(field[key]=privateValueObj),field[privateKey]=null,!0)}):any(valueKeys,function(key){var valueObj=field[key];return key in field&&(exists(valueObj)&&(field["$"+key]=valueObj),field[key]=null,!0)}))}function ComplexValue(fields){this.$id="$ComplexValue"+random(),this.fieldMap={},this.fieldKeySet=[],ComplexValue.Caches[this.$id]=this,this.putAll(fields)}function DependentRule(rule,field,schema){this.dependExpressList=getDependExpressList(rule).map(function(dependExpress){var field=searchField(dependExpress.fieldId,schema);field||console.warn("cant find field for dep rule. -> "+dependExpress.fieldId);var symbol=SYMBOLS[dependExpress.symbol];return symbol||console.warn("没有找到可用符号: "+dependExpress.symbol),{field:field,value:dependExpress.value,symbol:symbol}}),this.value=rule.value,this.origin=rule,this.$fieldId=field.id,DependentRule.fieldCache[field.id]=field}function FieldRepeater(fieldList,schema,parentScope,targetElement,$compile){this.fieldList=fieldList,this.schema=schema,this.repeaterScope=parentScope.$new(),this.targetElement=targetElement,this.$compile=$compile}var find,findIndex,each,any,all,exists,is,FIELD_TYPES={INPUT:"INPUT",MULTI_INPUT:"MULTIINPUT",SINGLE_CHECK:"SINGLECHECK",MULTI_CHECK:"MULTICHECK",COMPLEX:"COMPLEX",MULTI_COMPLEX:"MULTICOMPLEX",LABEL:"LABEL"},VALUE_TYPES={TEXT:"text",TEXTAREA:"textarea",INTEGER:"integer",LONG:"long",DECIMAL:"decimal",DATE:"date",TIME:"time",URL:"url",HTML:"html"},SYMBOLS={NOT_CONTAINS:{key:"not contains"},NOT_EQUALS:{key:"!="},EQUALS:{key:"=="}};SYMBOLS["not contains"]=SYMBOLS.NOT_CONTAINS,SYMBOLS["!="]=SYMBOLS.NOT_EQUALS,SYMBOLS["=="]=SYMBOLS.EQUALS,function(){is={},exists=function(target){return null!==target&&void 0!==target},window._?(find=_.find,any=_.some,all=_.every,each=_.each,findIndex=_.findIndex,is.string=_.isString,is.array=_.isArray):console.warn("Please import underscore !!!")}(),ComplexValue.Caches={},ComplexValue.prototype.get=function(field){return this.fieldMap[field.id||field]},ComplexValue.prototype.put=function(field){return this.fieldKeySet.push(field.id),this.fieldMap[field.id]=field,field.$parentComplexValueId=this.$id,this},ComplexValue.prototype.putAll=function(fields){var self=this;return each(fields,function(f){self.put(angular.copy(f))}),self},ComplexValue.prototype.copyFrom=function(originComplexValue,field){var self=this,fieldMap=originComplexValue.fieldMap||(originComplexValue.fieldMap={});return each(field.fields,function(childField){var mapItem=fieldMap[childField.id];mapItem?(mapItem.rules=childField.rules,mapItem.name=childField.name,mapItem.options=childField.options,mapItem.fieldValueType=childField.fieldValueType):mapItem=angular.copy(childField),self.put(mapItem)}),self},DependentRule.fieldCache={},DependentRule.prototype.checked=function(){var self=this,dependExpressList=self.dependExpressList,currRule=self.origin,currentField=DependentRule.fieldCache[self.$fieldId],forceFail=!1,result=all(dependExpressList,function(express){var parentDisableRule,parentComplexValue,targetFieldInComplex=null,targetField=express.field;if(currentField.$parentComplexValueId&&(parentComplexValue=ComplexValue.Caches[currentField.$parentComplexValueId],parentComplexValue&&(targetFieldInComplex=parentComplexValue.get(targetField),targetFieldInComplex&&(targetField=targetFieldInComplex))),!targetField)return!(forceFail=!0);if("disableRule"===currRule.name&&(parentDisableRule=getRules(targetField).disableRule)&&parentDisableRule.checked())return!0;var value=targetField.values||targetField.value;if(value&&"value"in value&&(value=value.value),null===value)return!(forceFail=!0);switch(express.symbol){case SYMBOLS.EQUALS:return value==express.value;case SYMBOLS.NOT_EQUALS:return value!=express.value;case SYMBOLS.NOT_CONTAINS:return!!value&&!any(value,function(valueObj){return valueObj.value==express.value});default:return!1}});return!forceFail&&result},DependentRule.prototype.getRegex=function(){return this.checked()?this.value:null},DependentRule.prototype.getLength=function(){return this.checked()?this.value:null},FieldRepeater.prototype.renderOne=function(field){var rules,disableRule,disabledExpression,fieldElement,fieldScope,self=this,schema=self.schema,parentScope=self.repeaterScope,targetElement=self.targetElement,$compile=self.$compile;"0"!=field.isDisplay&&(rules=getRules(field,schema),disableRule=rules.disableRule,(!disableRule||disableRule instanceof DependentRule||disableRule.value!==!0)&&(fieldElement=angular.element("<s-field>"),fieldScope=parentScope.$new(),fieldScope.field=field,fieldElement.attr("field","field"),disableRule instanceof DependentRule&&(fieldScope.disabled=disableRule,disabledExpression="!disabled.checked()",fieldElement.attr("ng-if",disabledExpression),fieldScope.$watch(disabledExpression,function(enabled){switchPrivateValue(field,["value","values","complexValues"],enabled)})),targetElement.append(fieldElement),$compile(fieldElement)(fieldScope)))},FieldRepeater.prototype.renderList=function(){var self=this,fieldList=self.fieldList;each(fieldList,function(field){self.renderOne(field)})},FieldRepeater.prototype.destroy=function(){var self=this,parentScope=self.repeaterScope,targetElement=self.targetElement;parentScope&&(parentScope.$destroy(),parentScope=null,self.repeaterScope=null),targetElement&&targetElement.length&&(targetElement.empty(),targetElement=null,self.targetElement=null)},angular.module("voyageone.angular.directives").directive("schema",function($compile){function SchemaController($scope){this.$scope=$scope}return SchemaController.prototype.getSchema=function(){return this.schema},SchemaController.prototype.$setSchema=function(data){this.schema=data},SchemaController.prototype.$render=function($element){var controller=this,$scope=controller.$scope,schema=controller.getSchema(),fieldRepeater=controller.fieldRepeater;fieldRepeater&&(fieldRepeater.destroy(),controller.fieldRepeater=null),schema&&schema.length&&(fieldRepeater=new FieldRepeater(schema,schema,$scope,$element,$compile),controller.fieldRepeater=fieldRepeater,fieldRepeater.renderList())},{restrict:"E",scope:!0,controllerAs:"schemaController",link:function($scope,$element,$attrs){$scope.$watch($attrs.data,function(data){var schemaController=$scope.schemaController;schemaController.$setSchema(data),schemaController.$render($element)})},controller:SchemaController}}).directive("sField",function($compile){function SchemaFieldController($scope,$element){this.originScope=$scope,this.$element=$element}return SchemaFieldController.prototype.render=function(){var $element,formController,showName,parentScope,$scope,field,container,hasValidate,rules,innerElement,isSimple,controller=this;if(controller.destroy(),parentScope=controller.originScope,$scope=parentScope.$new(),controller.$scope=$scope,$element=controller.$element,formController=controller.formController,showName=controller.showName,field=controller.field,container=$element,hasValidate=!!formController&&hasValidateRule(field),rules=getRules(field),isSimple=field.type!=FIELD_TYPES.COMPLEX&&field.type!=FIELD_TYPES.MULTI_COMPLEX,showName&&container.append(angular.element("<s-header>")),innerElement=angular.element('<div class="s-wrapper">'),container.append(innerElement),container=innerElement,innerElement=angular.element("<s-container>"),container.append(innerElement),hasValidate&&isSimple){var formName=formController.$name,voMessage=angular.element('<vo-message target="'+formName+"."+field.$name+'"></vo-message>');container.append(voMessage)}bindDefaultValueTip(container,field),bindTipRule(container,rules),$compile($element.contents())($scope)},SchemaFieldController.prototype.remove=function(complexValue){var $scope=this.$scope,list=$scope.$complexValues,index=list.indexOf(complexValue);list.splice(index,1)},SchemaFieldController.prototype.getField=function(){return this.field},SchemaFieldController.prototype.setField=function(field){field&&(field.$name="f"+random()),this.field=field},SchemaFieldController.prototype.destroy=function(){var controller=this,$element=controller.$element,$scope=controller.$scope;$element&&$element.empty(),$scope&&($scope.$destroy(),controller.$scope=null)},{restrict:"E",require:["^^?form"],scope:!0,controllerAs:"schemaFieldController",link:function($scope,$element,$attrs,requiredControllers){var controller=$scope.schemaFieldController;return controller.formController=requiredControllers[0],$attrs.field?(controller.showName=!$attrs.showName||"true"===$attrs.showName,controller.canAdd="false"!==$attrs.add,void $scope.$watch($attrs.field,function(field){controller.setField(field),field&&controller.render()})):void $element.text("请提供 field 属性。")},controller:SchemaFieldController}}).directive("sHeader",function(){return{restrict:"E",require:["^^sField"],scope:!1,link:function(scope,element,attrs,requiredControllers){var schemaFieldController=requiredControllers[0],field=schemaFieldController.getField(),rules=getRules(field),required=rules.requiredRule,requiredClass="s-required";switch(field.type){case FIELD_TYPES.INPUT:case FIELD_TYPES.SINGLE_CHECK:case FIELD_TYPES.MULTI_CHECK:element.addClass("simple");break;case FIELD_TYPES.COMPLEX:element.addClass("complex");break;case FIELD_TYPES.MULTI_COMPLEX:element.addClass("complex multi")}element.text(field.name||field.id),required&&(required instanceof DependentRule?scope.$watch(function(){return required.checked()},function(required){element[required?"addClass":"removeClass"](requiredClass)}):element.addClass(requiredClass))}}}).directive("sContainer",function($compile,$filter){return{restrict:"E",scope:!1,require:["^^sField"],link:function(scope,element,attrs,requiredControllers){var innerElement,schemaFieldController=requiredControllers[0],field=schemaFieldController.getField(),rules=getRules(field),name=field.$name;switch(scope.field=field,scope.rules=rules,field.type){case FIELD_TYPES.INPUT:!function(){var _value,regexRule=rules.regexRule,valueTypeRule=rules.valueTypeRule,requiredRule=rules.requiredRule,readOnlyRule=rules.readOnlyRule,type=getInputType(valueTypeRule),isDate=type.indexOf("date")>-1;if("textarea"===type?(innerElement=angular.element('<textarea class="form-control">'),valueTypeRule===VALUE_TYPES.HTML&&innerElement.addClass("s-html")):innerElement=angular.element('<input class="form-control">').attr("type",type),innerElement.attr("name",name),bindBoolRule(innerElement,readOnlyRule,"readOnlyRule","readonly"),bindBoolRule(innerElement,requiredRule,"requiredRule","required"),bindInputLengthRule(innerElement,rules),regexRule&&(regexRule instanceof DependentRule?innerElement.attr("ng-pattern","rules.regexRule.getRegex()"):"yyyy-MM-dd"!==regexRule.value&&innerElement.attr("pattern",regexRule.value)),innerElement.attr("title",field.name||field.id),_value=field.value,field.value=getInputValue(_value,field,valueTypeRule),!field.value&&exists(field.defaultValue)&&(_value=field.defaultValue,field.value=getInputValue(_value,field,valueTypeRule)),isDate?(scope.dateValue=field.value,field.value=_value,innerElement.attr("ng-model","dateValue"),scope.$watch("dateValue",function(newDate){field.value=$filter("date")(newDate,"date"===type?"yyyy-MM-dd":"yyyy-MM-dd hh:mm:ss")})):innerElement.attr("ng-model","field.value"),(!readOnlyRule||readOnlyRule instanceof DependentRule)&&isDate){var inputGroup=angular.element('<div class="input-group">'),inputGroupBtn=angular.element('<span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="$opened = !$opened"><i class="glyphicon glyphicon-calendar"></i></button>');innerElement.attr("uib-datepicker-popup",""),innerElement.attr("is-open","$opened"),readOnlyRule instanceof DependentRule&&inputGroupBtn.attr("ng-if","!rules.readOnlyRule.checked()"),inputGroup.append(innerElement),inputGroup.append(inputGroupBtn),innerElement=inputGroup}}();break;case FIELD_TYPES.SINGLE_CHECK:!function(){var nullValueObj,requiredRule=rules.requiredRule,options=field.options;field.value?field.value.value=getInputValue(field.value.value,field):field.value={value:null},!exists(field.value.value)&&exists(field.defaultValue)&&(field.value.value=getInputValue(field.defaultValue,field)),requiredRule||(options=options.map(function(option){var newOption={};return newOption.__proto__=option,newOption.value=getInputValue(option.value,field),newOption}),options.unshift(nullValueObj={displayName:"",value:null}),field.value.value||(field.value=nullValueObj)),scope.$options=options,innerElement=angular.element('<select class="form-control">'),innerElement.attr("ng-options","option.value as option.displayName for option in $options"),innerElement.attr("name",name),innerElement.attr("ng-model","field.value.value"),innerElement.attr("title",field.name||field.id),bindBoolRule(innerElement,requiredRule,"requiredRule","required"),bindBoolRule(innerElement,rules.readOnlyRule,"readOnlyRule","readonly")}();break;case FIELD_TYPES.MULTI_CHECK:!function(){var selected,valueStringList,requiredRule=rules.requiredRule,defaultValues=field.defaultValues;innerElement=[],selected=scope.selected=[],
scope.update=function(index){var selectedValue=field.options[index].value,selectedIndex=findIndex(field.values,function(valueObj){return valueObj.value==selectedValue});scope.selected[index]?selectedIndex<0&&field.values.push({value:selectedValue}):selectedIndex>-1&&field.values.splice(selectedIndex,1)},field.values||(field.values=[]),valueStringList=field.values.map(function(valueObj){return valueObj.value=getInputValue(valueObj.value,field).toString()}),each(field.options,function(option,index){var label=angular.element("<label></label>"),checkbox=angular.element('<input type="checkbox">');checkbox.attr("ng-model","selected["+index+"]"),checkbox.attr("name",name),checkbox.attr("title",field.name||field.id),checkbox.attr("ng-change","update("+index+")"),requiredRule&&(requiredRule instanceof DependentRule?checkbox.attr("ng-required","rules.requiredRule.checked() && !field.values.length"):checkbox.attr("ng-required","!field.values.length")),bindBoolRule(checkbox,rules.readOnlyRule,"readOnlyRule","readonly"),valueStringList.length?selected[index]=!(valueStringList.indexOf(option.value)<0):requiredRule&&defaultValues.length&&(selected[index]=!(defaultValues.indexOf(option.value)<0)),label.append(checkbox,"&nbsp;",option.displayName),innerElement.push(label)})}();break;case FIELD_TYPES.COMPLEX:var fieldValueMap,complexValue=field.complexValue;complexValue&&(fieldValueMap=complexValue.fieldMap,fieldValueMap&&each(field.fields,function(childField){var valueObj=fieldValueMap[childField.id];valueObj&&resetValue(valueObj,childField)})),scope.$fields=field.fields,innerElement=angular.element('<s-complex fields="$fields">');break;case FIELD_TYPES.MULTI_COMPLEX:var complexValues=field.complexValues;complexValues||(complexValues=[]),complexValues.length?complexValues=complexValues.map(function(complexValueObj){return(new ComplexValue).copyFrom(complexValueObj,field)}):complexValues.push(new ComplexValue(field.fields)),field.complexValues=complexValues,scope.$complexValues=complexValues,innerElement=angular.element('<s-complex multi="true" fields="complexValue.fieldMap">'),innerElement.attr("ng-repeat","complexValue in $complexValues"),schemaFieldController.canAdd&&element.append(angular.element("<s-toolbar>"));break;default:element.text("不支持的类型")}innerElement instanceof Array?each(innerElement,function(childElement){element.append(childElement)}):element.append(innerElement),$compile(element.contents())(scope)}}}).directive("sComplex",function($compile){function SchemaComplexController($scope,$attrs){this.$scope=$scope,this.fields=$scope.$eval($attrs.fields)}return SchemaComplexController.prototype.$render=function(schema,isMulti,$element){var controller=this,fields=controller.fields,$scope=controller.$scope,repeater=controller.repeater;if(repeater&&(repeater.destroy(),controller.repeater=null),fields&&(repeater=new FieldRepeater(fields,schema,$scope,$element,$compile),controller.repeater=repeater,repeater.renderList(),isMulti&&$scope.schemaFieldController.canAdd)){var toolbox=angular.element("<s-toolbox>");$element.append(toolbox),$compile(toolbox)($scope)}},{restrict:"E",scope:!0,require:["^^?schema","^^sField"],controllerAs:"schemaComplexController",link:function($scope,$element,$attrs,requiredControllers){var controller=$scope.schemaComplexController,isMulti="true"===$attrs.multi,schemaController=requiredControllers[0];schemaController?controller.$render(schemaController.getSchema(),isMulti,$element):controller.$render(null,isMulti,$element)},controller:SchemaComplexController}}).directive("sToolbar",function(){return{restrict:"E",require:["^^sField"],template:'<button class="btn btn-schema btn-success" ng-click="$newComplexValue()"><i class="fa fa-plus"></i></button>',scope:!1,link:function($scope){$scope.$newComplexValue=function(){$scope.$complexValues.push(new ComplexValue($scope.field.fields))}}}}).directive("sToolbox",function(){return{restrict:"E",require:["^^sField","^^sComplex"],template:'<button class="btn btn-schema btn-danger" ng-click="schemaFieldController.remove(complexValue)" ng-if="$complexValues.length > 1"><i class="fa fa-trash-o"></i></button>',scope:!1}})}(),angular.module("voyageone.angular.directives").directive("tabInTextarea",function(){return{restrict:"A",link:function(scope,element){$(element).keydown(function(e){if(9===e.keyCode){var start=this.selectionStart,end=this.selectionEnd,$this=$(this),value=$this.val();$this.val(value.substring(0,start)+"\t"+value.substring(end)),this.selectionStart=this.selectionEnd=start+1,e.preventDefault()}})}}}),angular.module("voyageone.angular.directives").directive("vpagination",function($templateCache,$compile,vpagination){var templateKey="voyageone.angular.directives.pagination.tpl.html",templateKeyNoData="voyageone.angular.directives.paginationNoData.tpl.html";$templateCache.get(templateKey)||$templateCache.put(templateKey,'<div class="row"><div class="col-sm-3"><span translate="TXT_SHOWING_NO"></span><span>&nbsp;</span><input class="text-center" type="text" ng-model="curr.pageNo"><span>&nbsp;</span><span>/</span><span>&nbsp;</span><span ng-bind="totalPages"></span><span>&nbsp;</span><span translate="TXT_PAGE"></span><span>&nbsp;</span><button class="btn btn-xs btn-default" type="button" ng-click="goPage(curr.pageNo)" translate="BTN_GO"></button></div><div class="col-sm-4 text-center"><span translate="TXT_PAGER_SIZE"></span><span>&nbsp;</span><select ng-change="changePerPage(perpages.selectedOption)" ng-options="option for option in perpages.availableOptions" ng-model="perpages.selectedOption"></select><span>&nbsp;</span><span translate="TXT_SHOWING"></span><span>&nbsp;</span><span ng-bind="curr.start"></span><span>&nbsp;</span><span>-</span><span>&nbsp;</span><span ng-bind="curr.end"></span><span>&nbsp;</span><span translate="TXT_OF"></span><span>&nbsp;</span><span ng-bind="totalItems"></span><span>&nbsp;</span><span translate="TXT_ITEMS"></span></div><div class="col-sm-5 text-right"><ul class="pagination"><li ng-class="{disabled: curr.isFirst}"><a href ng-click="goPage(1)" ng-disabled="curr.isFirst">&laquo;</a></li><li ng-class="{disabled: curr.isFirst}"><a href ng-click="goPage(curr.pageNo - 1)" ng-disabled="curr.isFirst">&lsaquo;</a></li><li ng-if="curr.isShowStart"><a href>...</a></li><li ng-repeat="page in curr.pages track by $index" ng-class="{active: isCurr(page)}"><a href ng-click="goPage(page)">{{page}}</a></li><li ng-if="curr.isShowEnd"><a href>...</a></li><li ng-class="{disabled: curr.isLast}"><a href ng-click="goPage(curr.pageNo + 1)" ng-disabled="curr.isLast">&rsaquo;</a></li><li ng-class="{disabled: curr.isLast}"><a href ng-click="goPage(totalPages)" ng-disabled="curr.isLast">&raquo;</a></li></ul></div></div>'),$templateCache.get(templateKeyNoData)||$templateCache.put(templateKeyNoData,'<div class="text-center">&nbsp;<span translate="TXT_SHOWING"></span>&nbsp;<span>0&nbsp;-&nbsp;0</span>&nbsp;<span translate="TXT_OF"></span>&nbsp;<span>0</span>&nbsp;<span translate="TXT_ITEMS"></span></div>');var defConfig={curr:1,total:0,size:10,showPageNo:5,fetch:null};return{restrict:"AE",replace:!1,scope:{$$configNameForA:"@vpagination",$$configNameForE:"@config"},link:function(scope,element){function refresh(){scope.totalPages=p.getPageCount(),scope.totalItems=p.getTotal(),scope.curr=p.getCurr(),scope.config.size=p.getSize(),scope.perpages={availableOptions:[10,20,50,100],selectedOption:scope.config.size};var tempHtml;tempHtml=0==p.getTotal()?$compile($templateCache.get(templateKeyNoData))(scope):$compile($templateCache.get(templateKey))(scope),element.html(tempHtml)}var userConfigName=scope.$$configNameForA||scope.$$configNameForE,userConfig=scope.$parent.$eval(userConfigName),userWithDefConfig=angular.extend({},defConfig,userConfig);scope.config=angular.extend(userConfig,userWithDefConfig),scope.config.setPageIndex=function(pageIndex){scope.config.curr==pageIndex?scope.config.fetch(scope.config.curr,scope.config.size):scope.goPage(pageIndex)};var p=new vpagination(scope.config);scope.$parent.$watch(userConfigName,function(){refresh()},!0),scope.goPage=function(num){p.goPage(isNaN(Number(num))?1:Number(num))},scope.isCurr=function(num){return p.isCurr(num)},scope.changePerPage=function(perpage){scope.config.size=parseInt(perpage),scope.config.curr=1,p.goPage(parseInt(scope.config.curr))}}}}),angular.module("voyageone.angular.directives").directive("ngCharMaxlength",function(){function getByteLength(value){var byteLen=0,len=value.length;if(value){for(var i=0;i<len;i++)value.charCodeAt(i)>255?byteLen+=2:byteLen++;return byteLen}return 0}return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var maxlength=-1;attr.$observe("ngCharMaxlength",function(value){var intVal=parseInt(value);maxlength=isNaN(intVal)?-1:intVal,ctrl.$validate()}),ctrl.$validators.maxlength=function(modelValue,viewValue){return maxlength<0||ctrl.$isEmpty(viewValue)||getByteLength(viewValue)<=maxlength}}}}}).directive("ngCharMinlength",function(){function getByteLength(value){var byteLen=0,len=value.length;if(value){for(var i=0;i<len;i++)value.charCodeAt(i)>255?byteLen+=2:byteLen++;return byteLen}return 0}return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var minlength=-1;attr.$observe("ngCharMinlength",function(value){var intVal=parseInt(value);minlength=isNaN(intVal)?-1:intVal,ctrl.$validate()}),ctrl.$validators.minlength=function(modelValue,viewValue){return minlength<0||ctrl.$isEmpty(viewValue)||getByteLength(viewValue)>=minlength}}}}}).directive("ngMaxvalue",function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var maxvalue=-1;attr.$observe("ngMaxvalue",function(value){maxvalue=/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/.test(value)?new Date(value):/^(\d+)(\.[0-9]{0,2})?$/.test(value)?isNaN(parseFloat(value))?-1:parseFloat(value):/^(\d+)$/.test(value)?isNaN(parseInt(value))?-1:parseInt(value):-1,ctrl.$validate()}),ctrl.$validators.maxvalue=function(modelValue,viewValue){return maxvalue<0||ctrl.$isEmpty(viewValue)||viewValue<=maxvalue}}}}}).directive("ngMinvalue",function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var minvalue=-1;attr.$observe("ngMinvalue",function(value){minvalue=/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/.test(value)?new Date(value):/^(\d+)(\.[0-9]{0,2})?$/.test(value)?isNaN(parseFloat(value))?-1:parseFloat(value):/^(\d+)$/.test(value)?isNaN(parseInt(value))?-1:parseInt(value):-1,ctrl.$validate()}),ctrl.$validators.minvalue=function(modelValue,viewValue){return minvalue<0||ctrl.$isEmpty(viewValue)||viewValue>=minvalue}}}}}).directive("ngMaxinputnum",function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var maxvalue=-1;attr.$observe("ngMaxinputvalue",function(value){maxvalue=isNaN(parseInt(value))?-1:parseInt(value),ctrl.$validate()}),ctrl.$validators.maxinputnum=function(modelValue,viewValue){return maxvalue<0||ctrl.$isEmpty(viewValue)||viewValue.length<=maxvalue}}}}}).directive("ngMininputnum",function(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var minvalue=-1;attr.$observe("ngMininputnum",function(value){minvalue=isNaN(parseInt(value))?-1:parseInt(value),ctrl.$validate()}),ctrl.$validators.mininputnum=function(modelValue,viewValue){return minvalue<0||ctrl.$isEmpty(viewValue)||viewValue.length>=minvalue}}}}}),angular.module("voyageone.angular.factories").factory("$dialogs",function($uibModal,$filter,$templateCache){function tran(translationId,values){return $filter("translate")(translationId,values)}var templateName="voyageone.angular.factories.dialogs.tpl.html",template='<div class="vo_modal vo-dialogs"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close" ng-click="close()"><span aria-hidden="true"><i ng-click="close()" class="fa fa-close"></i></span></button><h5 class="modal-title"><i class="fa fa-exclamation-triangle"></i>&nbsp;<span ng-bind-html="title"></span></h5></div><div class="modal-body"><div class="text-left" ng-bind-html="content"></div></div><div class="modal-footer"><button class="btn btn-default btn-sm" ng-if="!isAlert" ng-click="close()" translate="BTN_CANCEL"></button><button class="btn btn-sm {{::isAlert?\'btn-default\':\'btn-vo\'}}" ng-click="ok()" translate="BTN_OK"></button></div></div>';return $templateCache.put(templateName,template),function(options){if(!_.isObject(options))throw"arg type must be object";var values;_.isObject(options.content)&&(values=options.content.values,options.content=options.content.id),options.title=tran(options.title),options.content=tran(options.content,values);var modalInstance=$uibModal.open({templateUrl:templateName,controller:["$scope",function(scope){_.extend(scope,options)}],size:"md"});return options.close=function(){modalInstance.dismiss("close")},options.ok=function(){modalInstance.close("")},modalInstance}}).factory("alert",function($dialogs){return function(content,title){return $dialogs({title:title||"TXT_ALERT",content:content,isAlert:!0}).result}}).factory("confirm",function($dialogs){return function(content,title){return $dialogs({title:title||"TXT_CONFIRM",content:content,isAlert:!1}).result}}),angular.module("voyageone.angular.factories").factory("interceptorFactory",function(){function autoRedirect(res){return res.code==CODE_SYS_REDIRECT&&(location.href=res.redirectTo||"/login.html",!0)}function sessionTimeout(res){return res.code==MSG_TIMEOUT&&(location.href="/login.html",!0)}function unknownException(response){response.data.code===UNKNOWN_CODE&&(window.$$lastUnknow=response,console.error("Server throw unknown exceptio. Message:",response.data.message))}var UNKNOWN_CODE="5",CODE_SYS_REDIRECT="SYS_REDIRECT",MSG_TIMEOUT="300001";return{request:function(config){return config},response:function(res){var result=res.data;return autoRedirect(result)||sessionTimeout(result)?res:(unknownException(res),res)},requestError:function(config){return config},responseError:function(res){}}}).config(function($httpProvider){$httpProvider.interceptors.push("interceptorFactory")}),angular.module("voyageone.angular.factories").factory("notify",function($filter){function notify(options){if(options&&(_.isString(options)&&(options={message:options}),_.isObject(options))){var values;return _.isObject(options.message)&&(values=options.message.values,options.message=options.message.id),options.message=$filter("translate")(options.message,values),$.notify(options.message,options)}}return notify.success=function(message){return notify({message:message,className:"success"})},notify.warning=function(message){return notify({message:message,className:"warning"})},notify.danger=function(message){return notify({message:message,className:"danger"})},notify}),angular.module("voyageone.angular.factories").factory("pppAutoImpl",function($q,$modal){function declarePopupMethods(declares,viewBaseUrl,jsBaseUrl,popupBaseKey){var impl={};return popupBaseKey&&(popupBaseKey+="/"),_.each(declares,function(declare,parentDir){if(!declare.popupKey)return void((_.isObject(declare)||_.isArray(declare))&&_.extend(impl,declarePopupMethods(declare,viewBaseUrl,jsBaseUrl,popupBaseKey+parentDir,$q,$modal)));var options=_.clone(declare.options)||{},pathBase="/"+popupBaseKey;_.isString(parentDir)&&(pathBase+=parentDir+"/"),pathBase+=declare.popupKey,options.templateUrl=viewBaseUrl+pathBase+".tpl.html",options.controllerUrl=jsBaseUrl+pathBase+".ctl",(declare.controllerAs||declare.controller)&&(options.controller=getControllerName(declare.popupKey)),declare.controllerAs&&(options.controller+=" as "+(_.isString(declare.controllerAs)?declare.controllerAs:"ctrl")),impl[declare.popupKey]=function(context){context&&(options.resolve={context:function(){return context}});var defer=$q.defer();return require([options.controllerUrl],function(){defer.resolve($modal.open(options).result)}),defer.promise}}),impl}function getControllerName(key){return key.replace(/\.(\w)/g,function(m,m1){return m1.toUpperCase()}).replace(/^(\w)/,function(m,m1){return m1.toLowerCase()})+"PopupController"}return function(declares,viewBaseUrl,jsBaseUrl){return declares.$$$&&declares.$$$.impl||(declares.$$$={impl:declarePopupMethods(declares,viewBaseUrl,jsBaseUrl,"")}),declares.$$$.impl}}),angular.module("voyageone.angular.factories").factory("selectRowsFactory",function(){return function(config){var _selectRowsInfo=config?config:{selAllFlag:!1,currPageRows:[],selFlag:[],selList:[]};this.selAllFlag=function(value){return void 0!==value?_selectRowsInfo.selAllFlag=value:_selectRowsInfo.selAllFlag},this.clearCurrPageRows=function(){_selectRowsInfo.currPageRows=[]},this.currPageRows=function(value){return void 0!==value?_selectRowsInfo.currPageRows.push(value):_selectRowsInfo.currPageRows},this.selFlag=function(value){return void 0!==value?_selectRowsInfo.selFlag.push(value):_selectRowsInfo.selFlag},this.selList=function(value){return void 0!==value?_selectRowsInfo.selList.push(value):_selectRowsInfo.selList},this.clearSelectedList=function(){_selectRowsInfo.selList=[],_selectRowsInfo.selFlag=[]},this.selectRowsInfo=_selectRowsInfo}}),angular.module("voyageone.angular.factories").factory("vpagination",function(){return function(config){function load(page){page=page||config.curr,page<1||page>getPages()||isCurr(page)||(config.curr=page,defaultPage=config.size,config.fetch(config.curr,config.size))}function createShowPages(){var minPage,maxPage,_showPages=[];config.curr<config.showPageNo?(minPage=1,maxPage=_pages<=config.showPageNo?_pages:config.showPageNo):config.curr+2>_pages?(minPage=_pages+1-config.showPageNo,maxPage=_pages):(minPage=config.curr+3-config.showPageNo,maxPage=config.curr+2);for(var i=minPage;i<=maxPage;i++)_showPages.push(i);return _showPages}function getPages(){return _lastTotal==config.total&&config.size===defaultPage||(_pages=parseInt(config.total/config.size)+(config.total%config.size>0?1:0),_lastTotal=config.total),_pages}function getCurrStartItems(){return(config.curr-1)*config.size+1}function getCurrEndItems(){var currEndItems=config.curr*config.size;return currEndItems<=config.total?currEndItems:config.total}function isLast(){return config.curr==getPages()}function isFirst(){return 1==config.curr}function isCurr(page){return config.curr==page&&config.size===defaultPage}function curr(){return config.curr}function isShowStart(){return _showPages=createShowPages(),_showPages[0]>1}function isShowEnd(){return _showPages=createShowPages(),_showPages[_showPages.length-1]<_pages}var _pages,_lastTotal=0,_showPages=[],defaultPage=config.size;this.getTotal=function(){return config.total},this.getSize=function(){return config.size},this.getCurr=function(){return{pageNo:curr(),start:getCurrStartItems(),end:getCurrEndItems(),isFirst:isFirst(),isLast:isLast(),pages:createShowPages(),isShowStart:isShowStart(),isShowEnd:isShowEnd()}},this.goPage=load,this.getPageCount=getPages,this.isCurr=isCurr}}),angular.module("voyageone.angular.vresources",[]).provider("$vresources",function($provide){function getActionUrl(root,action){return root+(root.lastIndexOf("/")===root.length-1?"":"/")+action}function actionHashcode(md5,root,actionName,args,cacheWith){var argsJson=angular.toJson(args),otherKeyJson=cacheWith?angular.toJson(cacheWith):"",md5Arg=root+actionName+argsJson+otherKeyJson;return md5.createHash(md5Arg)}function closureDataService(name,actions,cacheKey){var _ServiceClass,root=actions.root;if(actions){if("object"!=typeof actions)return void console.log("Failed to new DataResource: ["+actions+"] is not a object");if(!root)return void console.log("Failed to new DataResource: no root prop"+angular.toJson(actions));_ServiceClass=function(ajax,$sessionStorage,$localStorage,md5,$q){this._a=ajax,this._sc=$sessionStorage,this._lc=$localStorage,this._5=md5,this._q=$q,this._c={}},_.each(actions,function(option,actionName){var _url,_root,_resolve,_reject,_cacheFlag,_cacheWith;return _.isString(option)?_url=option:_.isObject(option)&&(_url=option.url,_resolve=option.then,_root=option.root,_cacheFlag=option.cache,_cacheWith=option.cacheWith,_cacheWith=_.isArray(_cacheWith)?_cacheWith.map(function(cacheKeyName){return cacheKey[cacheKeyName]}).filter(function(cacheKeyValue){return!!cacheKeyValue}):null),_url?(_root===!1?_root="":null!==_root&&void 0!==_root&&_root!==!0||(_root=root),_.isArray(_resolve)&&(_reject=_resolve[1],_resolve=_resolve[0]),_.isFunction(_resolve)||(_resolve=function(res){return res}),(!_cacheFlag||_cacheFlag>3)&&(_cacheFlag=0),_url=getActionUrl(_root,_url),void(_ServiceClass.prototype[actionName]=0===_cacheFlag?function(args){return this._a.post(_url,args).then(_resolve,_reject)}:function(args){var deferred,result,session=this._sc,local=this._lc,hash=actionHashcode(this._5,root,actionName,args,_cacheWith),promise=this._c[hash];return promise?promise:(deferred=this._q.defer(),promise=deferred.promise,this._c[hash]=promise,result=2===_cacheFlag?session[hash]:3===_cacheFlag?local[hash]:null,null!==result&&void 0!==result?deferred.resolve(result):this._a.post(_url,args).then(function(res){switch(result=_resolve(res),_cacheFlag){case 2:session[hash]=result;break;case 3:local[hash]=result}deferred.resolve(result)},function(res){result=_reject(res),deferred.reject(result)}),promise)})):void console.error("URL is undefined",option)}),$provide.service(name,["ajaxService","$sessionStorage","$localStorage","md5","$q",_ServiceClass])}}this.$get=function(){return{register:function(name,actions,cacheKey){if(actions&&"object"==typeof actions){if(actions.root)return void closureDataService(name,actions,cacheKey);for(var childName in actions)actions.hasOwnProperty(childName)&&this.register(childName,actions[childName],cacheKey)}}}}}),angular.module("voyageone.angular.services").service("$ajax",$Ajax).service("ajaxService",AjaxService),$Ajax.prototype.post=function(url,data){var defer=this.$q.defer();return void 0===data&&(data={}),this.$http.post(url,data).then(function(response){var res=response.data;return res?res.message||res.code?void defer.reject(res):void defer.resolve(res):(alert("相应结果不存在?????"),void defer.reject(null))},function(response){defer.reject(null,response)}),defer.promise},AjaxService.prototype.post=function(url,data){var defer=this.$q.defer();return this.$ajax.post(url,data).then(function(res){return defer.resolve(res),res},function(_this){return function(res){return _this.messageService.show(res),defer.reject(res),res}}(this)),defer.promise},angular.module("voyageone.angular.services").service("cookieService",CookieService);var keys={language:"voyageone.user.language",company:"voyageone.user.company",channel:"voyageone.user.channel",application:"voyageone.user.application"};CookieService.prototype.get=function(key){var result=this.$cookies.get(key);if(void 0===result||null===result)return"";if(0!==result.indexOf("{"))return result;var item=JSON.parse(result);return item.value},CookieService.prototype.set=function(key,value){var item=new Cookie(key,value);return this.$cookies.put(key,angular.toJson(item))},CookieService.prototype.removeAll=function(){this.$cookies.remove(keys.language),this.$cookies.remove(keys.company),this.$cookies.remove(keys.channel),this.$cookies.remove(keys.application)},CookieService.prototype.language=makeProps(keys.language),CookieService.prototype.company=makeProps(keys.company),CookieService.prototype.channel=makeProps(keys.channel),CookieService.prototype.application=makeProps(keys.application),angular.module("voyageone.angular.services").service("messageService",MessageService);var DISPLAY_TYPES={ALERT:1,NOTIFY:2,POP:3,CUSTOM:4};MessageService.prototype={show:function(res){var displayType=res.displayType,message=res.message;switch(displayType){case DISPLAY_TYPES.ALERT:this.alert(message);break;case DISPLAY_TYPES.NOTIFY:this.notify(message);break;case DISPLAY_TYPES.POP:this.notify({message:message,position:"right bottom"})}}},angular.module("voyageone.angular.services").service("permissionService",PermissionService),PermissionService.prototype={setPermissions:function(permissions){this.permissions=permissions,this.$rootScope.$broadcast("permissionsChanged")},has:function(permission){return _.contains(this.permissions,permission.trim())}},angular.module("voyageone.angular.services").service("translateService",TranslateService),TranslateService.prototype={languages:{en:"en",zh:"zh"},setLanguage:function(language){return _.contains(this.languages,language)||(language=this.getBrowserLanguage()),this.$translate.use(language),language},getBrowserLanguage:function(){var currentLang=navigator.language;return currentLang||(currentLang=navigator.browserLanguage),currentLang.substr(0,2)}};
//# sourceMappingURL=voyageone.angular.com.js.map