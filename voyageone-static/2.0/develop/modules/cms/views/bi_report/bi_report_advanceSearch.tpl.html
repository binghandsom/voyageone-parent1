<div class="wrapper-md" ng-init="initialize()">
    <uib-accordion class="vo_accordion vo_attr" close-others="oneAtATime">
        <uib-accordion-group is-open="vm.status.open">
            <uib-accordion-heading>
                <i class="glyphicon glyphicon-star"></i>&nbsp;BI报表下载
                <i class="pull-right glyphicon glyphicon-menu-down" ng-class="{'glyphicon-menu-up': vm.status.open, 'glyphicon-menu-down': !vm.status.open}"></i>
            </uib-accordion-heading>
         <!--   主体-->
            <div class="container-fluid  m-t-sm">
                <div class="col-sm-8 m-t-sm">
                    <label class="col-sm-2 text-right"> 渠道 </label>
                    <div class="col-sm-10">
                        <div class="col-sm-6">
                            <div class="form-group ">
                                <select multiple chosen width="'55%'" class=" text-left m-t-sm form-control" ng-model="vm.searchInfo.channelCodeList"
                                        ng-options="brand.channel_id as brand.channel_name for brand in channels">
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" >销售时间段</label>
                                <div class="col-sm-8 form-inline">
                                    <div class="col-sm-5 input-group">
                                        <input type="text" class="form-control" uib-datepicker-popup ng-model="vm.searchInfo.staDate"
                                               min-date ="vm.minDate"
                                               max-date = "vm.searchInfo.endDate"
                                               date-model-format = "yyyy-MM-dd"
                                               is-open = "datePicker3" ng-required="true"
                                               close-text="Close" />
                                        <span class="input-group-btn">
								                <button type="button" class="btn btn-default" ng-click="datePicker3 = !datePicker3"><i class="glyphicon glyphicon-calendar"></i></button>
								              </span>
                                    </div>&nbsp;~&nbsp;
                                    <div class="col-sm-5 input-group">
                                        <input type="text" class="form-control" uib-datepicker-popup
                                               ng-model="vm.searchInfo.endDate"
                                               min-date="vm.searchInfo.staDate"
                                               max-date=" vm.maxDate "
                                               date-model-format="yyyy-MM-dd" is-open="datePicker4" ng-required="true" close-text="Close" />
                                        <span class="input-group-btn">
								                <button type="button" class="btn btn-default" ng-click="datePicker4 = !datePicker4"><i class="glyphicon glyphicon-calendar"></i></button>
								              </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-8 m-t-sm">
                    <div >  <label class="col-sm-2 text-right">  文件类型：</label> &nbsp;
                        <button  class="btn  btn-xs"  ng-click="selectAllFileTypes()"  ng-bind="selectFileButton" ></button>
                    </div>
                    <div class="col-sm-10 text-center" ng-switch="vm.searchInfo.channelCodeList.length">

                        <div class="col-sm-4" ng-switch-when= "0" ng-repeat="item in fileTypes">
                            <div class="form-inline">
                                <input type="checkbox" class="form-control" ng-true-value="{{item.fileTypeCode}}" ng-false-value="false" ng-model="vm.searchInfo.fileTypes[$index]" /> {{item.fileTypeName}}
                            </div>
                        </div>
                        <div class="col-sm-4" ng-switch-when= "1" ng-repeat="item in fileTypes">
                            <div class="form-inline">
                                <input type="checkbox" class="form-control" ng-true-value="{{item.fileTypeCode}}" ng-false-value="false" ng-model="vm.searchInfo.fileTypes[$index]" /> {{item.fileTypeName}}
                            </div>
                        </div>
                        <div class="col-sm-4" ng-switch-default  ng-repeat="item in fileTypes">
                            <div class="form-inline" ng-if= "item.fileTypeCode <=3">
                                <input type="checkbox" class="form-control" ng-true-value="{{item.fileTypeCode}}" ng-false-value="false" ng-model="vm.searchInfo.fileTypes[$index]" /> {{item.fileTypeName}}
                            </div>
                        </div>
                    </div><!-- .form-inline -->
                <br />
                </div>
                <div class="col-sm-12 text-center m-t-md" ng-controller="popupCtrl">
                    <div class="col-sm-10 text-center m-t-md" >
                        <button class="btn btn-default" ng-click="clear()"><i class="fa fa-remove"></i>&nbsp;{{'BTN_CLEAR' | translate}}</button>
                        <!-- <button class="btn btn-vo" ng-click="biRepDownload()"><i class="fa fa-search"></i>&nbsp;{{'BTN_SEARCH' | translate}}</button>-->
                        <button class="btn  btn-default " ng-click="createXlsFileTask()"><i class="fa fa fa-mail-reply"></i>生成文件</button>
                    </div>
                </div>
            </div>
            <br>
            <br>
        </uib-accordion-group>
    </uib-accordion>

    <div class="box">
        <div class="box-body-new">
            <table class="table table-hover-new text-center" >
                <thead>
                <tr>
                    <th class="text-left "><Button type="button" class="btn btn-pop btn-default"  ng-click="search()"><i class="fa fa-refresh"></i></Button></th>
                    <th class="text-left" >编号</th>
                    <th class="text-left">导出文件名称</th>
                    <th class="text-left" >查询时间段</th>
                    <th class="text-left"> 查询渠道</th>
                    <th class="text-left" >查询文件类型</th>
                    <th class="text-left"> 申请导出时间</th>
                    <th class="text-left" >文件生成时间</th>
                    <th class="text-left"> 导出申请者</th>
                    <th class="text-left"> 文件状态</th>
                    <th class="text-left">操作</th>
                </tr>
                </thead>
                <tbody  ng-if="vm.downloadTaskList.length" ng-controller="popupCtrl" >
                    <tr ng-repeat="item in vm.downloadTaskList">
                        <td class="text-left"></td>
                        <td class="text-left">
                            {{ item.id }}
                        </td>
                        <td class="text-left">{{item.fileName}}</td>
                        <td class="text-left">{{item.checkPeriod}}</td>
                        <td class="text-left">{{item.checkChannels}}</td>
                        <td class="text-left">{{item.checkFileTypes}}</td>
                        <td class="text-left">{{item.created}}</td>
                        <td class="text-left">{{item.finishTime}}</td>
                        <td calss="text-left">{{item.creater}}</td>
                        <td class="text-left" ng-switch = "item.taskStatus">
                            <span ng-switch-when="1">生成失败</span>
                            <span ng-switch-when="2">生成中</span>
                            <span ng-switch-when="3">已完成</span>
                            <span ng-switch-default>未生成</span>
                        </td>
                       <!-- <td class="text-left"><button class="btn btn-danger btn-xs" ng-click="test2()"><i class="fa fa-cloud-download"></i>文件下载</button></td>　-->　　<!--downloadExcel(item)-->
                        <td class="text-right" ng-controller="popupCtrl">
                            <button ng-if = "item.taskStatus != '2' "  title="{{'BTN_DELETE' | translate}}" class="btn btn-danger btn-xs"  ng-click="del(item)"><i class="fa  fa-trash-o"></i></button>
                            <button ng-if = "item.taskStatus == '3' " title="{{'BTN_DOWNLOAD' | translate}}" class="btn btn-danger btn-xs" ng-click="openOtherDownload(item)"><i class="fa fa-cloud-download"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div  if-no-rows="vm.promotionList.length"></div>
        </div><!-- /.box-body -->
        <div class="col-sm-12 m-t-lg m-b-lg">
            <vpagination config="dataPageOption"></vpagination>
        </div>


    </div>






</div><!-- end .wrapper-md -->