
<script>

	//controller getList
	var controllerGet="/cms/system/businesslog/getlist";
	//controller updateFinishStatus
	var controllerUpdate="/cms/system/businesslog/updateFinishStatus";
	//TR 模板
	var exampleTr="<tr>"+$("#errorLogTBody tr").eq(0).html()+"</tr>";

	$(function(){
		getList(buildRequestJSON());
		$("#model_search").click(getList(buildRequestJSON()));
	});

	function buildRequestJSON(){
		var jsonStr="{";
		if($("#model_cartId").val()!=-1){
			jsonStr+="\"cartId\":"+$("#model_cartId").val();
			jsonStr+=",";
		}
		if($("#model_productName").val()!=null&&$("#model_productName").val()!=""){
			jsonStr+="\"productName\":"+"\""+$("#model_productName").val()+"\"";
			jsonStr+=",";
		}
		if($("#model_productIds").val()!=null&&$("#model_productIds").val()!=""){
			jsonStr+="\"productIds\":"+"["+$("#model_productIds").val().split('\n')+"]";
			jsonStr+=",";
		}
		if($("#model_errType").val()!=-1){
			jsonStr+="\"errType\":"+"\""+$("#model_errType").val()+"\"";
			jsonStr+=",";
		}
		if($("#model_catId").val()!=-1){
			jsonStr+="\"catId\":"+"\""+$("#model_catId").val()+"\"";
			jsonStr+=",";
		}
		if(jsonStr.length>2){
			jsonStr=jsonStr.substr(0,jsonStr.length-1);
		}
		jsonStr+="}";
		return jsonStr;
	}

	function getList(jsondata){
		$.ajax({
			type:"post",
			url:controllerGet,
			data:jsondata,
			contentType: "application/json;charset=utf-8",
			success:function(data){
				$("#errorLogTBody").html("");
				$.each(data.data.cmsBtBusinessLogModels, function(i, item) {
					var temp=exampleTr;
					$("#errorLogTBody").append(
							temp.replace("$seq",item.seq)
							.replace("$hid",item.seq)
							.replace("$promotionName",item.promotionName)
							.replace("$groupId",item.groupId)
							.replace("$groupName",item.groupName)
							.replace("$productCode",item.productId)
							.replace("$productName",item.productName)
							.replace("$errorCode",item.errorCode)
							.replace("$errorMsg",item.errMsg)
							.replace("$createTime",item.created)
				);
			})},
			error:function(data){
				alert("服务器异常 请稍后再试"+data);
			}
		});
	}

	function updateModel(seq){
		$.ajax({
			type:"post",
			url:controllerUpdate,
			data:"{\"seq\":"+seq+"}",
			contentType: "application/json;charset=utf-8",
			success:function(data) {
				getList(buildRequestJSON());
			},
			error:function(data){
				alert("服务器异常 请稍后再试"+data);
			}
		});
	}
</script>
<div class="wrapper-md">
	<div class="col-sm-12">
		<!-- search -->
		<div class="panel panelPromotion">
			<div class="container-fluid m-t-sm">
				<div class="col-sm-12">
					<div class="col-sm-4">
						<div class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-3 control-label">平台</label>
								<div class="col-sm-9">
									<select class="form-control" id="model_cartId">
										<option value="-1" selected = "selected" >ALL</option>
										<option value="24">TM</option>
										<option value="23">JD</option>
										<option value="12">JM</option>
										<option value="15">TB</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label"><a href="#" class="text-u-l" target="_blank">主类目</a></label>
								<div class="col-sm-9">
									<select class="form-control" id="model_catId">
										<option value="-1">All</option>
										<option value="1">珠宝/钻石/翡翠/黄金>彩色宝石/贵重宝石>手饰1</option>
										<option value="2">珠宝/钻石/翡翠/黄金>彩色宝石/贵重宝石>手饰2</option>
										<option value="3">珠宝/钻石/翡翠/黄金>彩色宝石/贵重宝石>手饰3</option>
										<option value="4">珠宝/钻石/翡翠/黄金>彩色宝石/贵重宝石>手饰4</option>
										<option value="5">珠宝/钻石/翡翠/黄金>彩色宝石/贵重宝石>手饰5</option>
									</select>
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-4">
						<div class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-3 control-label">商品名称</label>
								<div class="col-sm-9">
									<input type="text" id="model_productName" placeholder="商品名称" class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">错误类别</label>
								<div class="col-sm-9">
									<select class="form-control" id="model_errType">
										<option value="-1" selected = selected>All：1234</option>
										<option value="5">Feed导入失败 ： 311</option>
										<option value="4">主数据导入失败 ： 1233</option>
										<option value="3">刷价格失败 ： 123</option>
										<option value="2">价格披露失败： 232</option>
										<option value="1">库存隔离失败： 232</option>
										<option value="9">聚美上新失败： 232</option>
									</select>
								</div>
							</div>
						</div><!-- .form-group -->
					</div>
					<div class="col-sm-4">
						<div class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-3 control-label">CODE列表</label>
								<div class="col-sm-8">
									<textarea class="form-control inherited" rows="4" id="model_productIds"></textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-12 text-center m-b-sm">
						<div class="form-inline">
							<button class="btn btn-default" ng-click="clear()"><i class="fa fa-remove"></i>&nbsp;取消</button>
							<button class="btn btn-vo" id="model_search" onclick="getList(buildRequestJSON())" ng-click="search()"><i class="fa fa-search"></i>&nbsp;{{'BTN_SEARCH' | translate}}</button>
						</div><!-- .form-inline -->
					</div>
				</div>
			</div>
		</div>
	</div><!-- .accordion --><!--/search-->

	<div class="col-sm-12">
		<div class="box">
			<div class="box-body">
				<table class="table table-hover-new">
					<thead>
					<tr>
						<th class="text-center">Seq.</th>
						<th class="text-center">Promotion Name</th>
						<th class="text-center">Group IID</th>
						<th class="text-center">Group Name</th>
						<th class="text-center">Product Code</th>
						<th class="text-center">Product Name</th>
						<th class="text-center">Error Code</th>
						<th class="text-left mfb-xxxs">Error Messege</th>
						<th class="text-center">Error Create Time</th>
						<th>Completed</th>
					</tr>
					</thead>
					<tbody id="errorLogTBody">

						<!-- 此行TR作为模板，删除请修改Js start-->
						<tr style="display:none">
							<td class="text-center">$seq</td>
							<td class="text-center text-u-l"><a href="#">$promotionName</a></td>
							<td class="text-center text-u-l"><a href="#">$groupId</a></td>
							<td class="text-center text-u-l"><a href="#">$groupName</a></td>
							<td class="text-center text-u-l"><a href="#">$productCode</a></td>
							<td class="text-center">$productName</td>
							<td class="text-center">$errorCode</td>
							<td class="text-left mfb-xxxs">$errorMsg</td>
							<td class="text-center">$createTime</td>
							<td>
								<div class="onoffswitch">
									<input type="checkbox" name="onoffswitch" value="$hid" onclick="updateModel(this.value)" class="onoffswitch-checkbox" id="myonoffswitch5" checked="">
									<label class="onoffswitch-label" for="myonoffswitch5">
										<span class="onoffswitch-inner"></span>
										<span class="onoffswitch-switch"></span>
									</label>
								</div>
							</td>
						</tr>
						<!-- 此行TR作为模板，删除请修改Js end-->

					</tbody>
				</table>
			</div><!-- /.box-body -->
		</div>
	</div><!-- .col-lg-12 -->
</div><!-- end .wrapper-md -->