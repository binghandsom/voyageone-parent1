<div ng-controller="editPromotionController" ng-init="initialize()">
    <div class="bg-light lter b-b wrapper-md vo_page_header clearfix">
        <div class="row">
            <!--<div class="vo_page_title col-sm-1"><h1 class="m-n font-thin h3 text-vo" translate="CMS_TXT_PROMOTION"></h1></div>-->
            <!-- .vo_page_title -->
            <div class="col-sm-9 text-left hidden-xs">
                <div class="form-inline"  ng-controller="navigationController">
                    <div class="form-group wtab-sm">
                        <h1 class="m-n font-thin h3 text-vo" translate="CMS_TXT_PROMOTION"></h1>
                    </div>
                    <div class="btn-group">
                        <select chosen="" ng-model="promotionId" ng-options="promotion.promotionId as promotion.name for promotion in $root.cmsMaster.promotionList" class="chosen-select input-md w-md" ng-change="goPromotionPageForBtn('3', promotionId)">
                        </select>
                    </div>

                    <div class="form-group">
                        <ul class="vo_prodcrumbs" id="style1">
                            <li ng-repeat="navigationPromotionInfo in navigationPromotionList">
                                <a href="" ng-bind="navigationPromotionInfo.name" ng-href="{{goPromotionPage('3', navigationPromotionInfo.promotionId)}}"></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- .col-sm-6 -->
            <div class="col-sm-3 text-right">
                <button  class="btn m-b-xs btn-sm btn-default btn-addon" ng-click="doAddPromotion()"><i class="fa fa-plus"></i><span translate="CMS_TXT_ADD_PROMOTION"></span></button>
            </div>
            <!-- .col-sm-5 -->
        </div>
        <!-- .row -->
    </div>

    <div class="wrapper-md">

        <div class="row">

            <div class="col-lg-12">

                <div ng-if="promotionType === '3'">
                    <accordion class="vo_accordion vo_attr" close-others="oneAtATime">
                        <accordion-group is-open="status.open">

                            <accordion-heading>{{oldPromotionInfo.name}}
                                <i class="pull-right glyphicon glyphicon-menu-down" ng-class="{'glyphicon-menu-up': status.open, 'glyphicon-menu-down': !status.open}"></i>
                            </accordion-heading>
                            <!-- effective toggle -->
                            <div class="m-b-sm vo_effToggle">
                                <div class="onoffswitch eff">
                                    <input type="checkbox" name="promotionEffective" class="onoffswitch-checkbox" id="promotionEffective" ng-model="promotionInfo.isEffective" ng-change="doUpdateEffective()">
                                    <label class="onoffswitch-label" for="promotionEffective">
                                        <span class="onoffswitch-inner"></span>
                                        <span class="onoffswitch-switch"></span>
                                    </label>
                                </div>
                            </div>
                            <!-- tab -->
                            <div>
                                <tabset class="tab-container">
                                    <!-- US Category Info -->
                                    <tab>
                                        <tab-heading><span class="glyphicon glyphicon-tag"></span>&nbsp;<span translate="CMS_TXT_PROMOTION"></span></tab-heading>
                                        <div class="container-fluid">
                                            <form class="form-horizontal" name="formPromotionInfo" novalidate="">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label for="txtPromotionName" class="col-sm-4 control-label vo_reqfield" translate="CMS_TXT_NAME"></label>
                                                        <div class="col-sm-8">
                                                            <input  type="text" name="txtPromotionName" id="txtPromotionName" class="form-control" ng-model= "promotionInfo.name" ng-maxlength="50" required="" ng-change="promotionChanged()">
                                                            <va-check ng-show="formPromotionInfo.txtPromotionName.$error.required" check-type="required"></va-check>
                                                            <va-check ng-show="formPromotionInfo.txtPromotionName.$error.maxlength" check-type="maxlength" check-param="50"></va-check>
                                                        </div>
                                                    </div><!-- .form-group -->

                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label vo_reqfield" translate="CMS_TXT_CART"></label>
                                                        <div class="col-sm-8">
                                                            <div class="input-group">

                                                                <ui-select name="selPromotionCartId" id="selPromotionCartId" ng-model="promotionInfo.cartId" theme="bootstrap" ng-disabled="disabled"
                                                                           class="text-left" name="selProtionCartId" ng-change="promotionChanged()" required="">
                                                                    <ui-select-match placeholder="Select..." class="text-left">{{$select.selected.cart_name}}</ui-select-match>
                                                                    <ui-select-choices repeat="cart.cart_id as cart in $root.cmsMaster.cartList | filter: $select.search">
                                                                        <span ng-bind-html="cart.cart_name | highlight: $select.search"></span>
                                                                    </ui-select-choices>
                                                                </ui-select>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-click="clearCartId()" class="btn btn-default">
                                                                <small>
                                                                    <em class="fa fa-times text-muted"></em>
                                                                </small>
                                                            </button>
                                                        </span>
                                                            </div>
                                                            <va-check ng-show="formPromotionInfo.selPromotionCartId.$error.required" check-type="required"></va-check>
                                                        </div>
                                                    </div><!-- .form-group -->

                                                    <div class="form-group">
                                                        <label for="txtPromotionAttachmentName" class="col-sm-4 control-label" translate="CMS_TXT_ATTACHMENT_NAME"></label>
                                                        <div class="col-sm-8">
                                                    <textarea class="form-control no-resize" ng-model= "promotionInfo.attachment" rows="3" id="txtPromotionAttachmentName"
                                                              name="txtPromotionAttachmentName" ng-maxlength="200" ng-change="promotionChanged()"></textarea>
                                                            <va-check ng-show="formPromotionInfo.txtPromotionAttachmentName.$error.maxlength" check-type="maxlength" check-param="200"></va-check>
                                                        </div>
                                                    </div><!-- .form-group -->

                                                    <div class="form-group">
                                                        <label for="txtPromotionComment" class="col-sm-4 control-label" translate="CMS_TXT_COMMENT"></label>
                                                        <div class="col-sm-8">
                                                            <textarea class="form-control no-resize" ng-model="promotionInfo.comment" rows="3" id="txtPromotionComment" name="txtPromotionComment" ng-change="promotionChanged()"></textarea>
                                                        </div>
                                                    </div><!-- .form-group -->

                                                </div><!--.col -->

                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label" translate="CMS_TXT_PREHEAT_DATE"></label>
                                                        <div class="form-group col-sm-8 p-r-none">
                                                            <div for="txtPromotionPreheatTimeStart" class="col-sm-5 p-l-none p-r-none" ng-controller="datePickerController">
                                                                <div class="input-group">
                                                                    <input type="text" name="txtPromotionPreheatTimeStart" ng-model="promotionInfo.preheatDateStart" id="txtPromotionPreheatTimeStart" class="form-control" datepicker-popup="{{$root.dateFormat}}"
                                                                           is-open="promotionPreHeadTimeStart" datepicker-options="dateOptions" close-text="Close"  ng-change="promotionChanged()" max-date="promotionInfo.preheatDateEnd"/>
                                                                    <span class="input-group-btn">
                                                                        <button type="button" class="btn btn-default" ng-click="openDatePicker($event, 'promotionPreHeadTimeStart')"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-1 p-l-none p-r-none text-center">-</div>
                                                            <div for="txtPromotionPreheatTimeEnd" class="col-sm-6 p-l-none p-r-none" ng-controller="datePickerController">
                                                                <div class="input-group">
                                                                    <input type="text" name="txtPromotionPreheatTimeEnd" ng-model="promotionInfo.preheatDateEnd" id="txtPromotionPreheatTimeEnd" class="form-control" datepicker-popup="{{$root.dateFormat}}"
                                                                           is-open="promotionPreHeadTimeEnd" datepicker-options="dateOptions" close-text="Close"  ng-change="promotionChanged()" min-date="promotionInfo.preheatDateStart"/>
                                                                    <span class="input-group-btn">
                                                                        <button type="button" class="btn btn-default" ng-click="openDatePicker($event, 'promotionPreHeadTimeEnd')"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <va-check ng-show="formPromotionInfo.txtPromotionPreheatTimeStart.$error.date || formPromotionInfo.txtPromotionPreheatTimeEnd.$error.date" check-type="date"></va-check>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label vo_reqfield" translate="CMS_TXT_EFFECTIVE_DATE"></label>
                                                        <div class="form-group col-sm-8 p-r-none">
                                                            <div for="txtPromotionEffectiveTimeStart" class="col-sm-5 p-l-none p-r-none" ng-controller="datePickerController">
                                                                <div class="input-group">
                                                                    <input type="text" name="txtPromotionEffectiveTimeStart" ng-model="promotionInfo.effectiveDateStart" id="txtPromotionEffectiveTimeStart" class="form-control" datepicker-popup="{{$root.dateFormat}}"
                                                                           is-open="promotionEffectiveTimeStart" datepicker-options="dateOptions" close-text="Close"  ng-change="promotionChanged()" required="" max-date="promotionInfo.effectiveDateEnd"/>
                                                                       <span class="input-group-btn">
                                                                       <button type="button" class="btn btn-default" ng-click="openDatePicker($event, 'promotionEffectiveTimeStart')"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                       </span>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-1 p-l-none p-r-none text-center">-</div>
                                                            <div for="txtPromotionEffectiveTimeEnd" class="col-sm-6 p-l-none p-r-none" ng-controller="datePickerController">
                                                                <div class="input-group">
                                                                    <input type="text" name="txtPromotionEffectiveTimeEnd" ng-model="promotionInfo.effectiveDateEnd" id="txtPromotionEffectiveTimeEnd" class="form-control" datepicker-popup="{{$root.dateFormat}}"
                                                                           is-open="promotionEffectiveTimeEnd" datepicker-options="dateOptions" close-text="Close"  ng-change="promotionChanged()" required="" min-date="promotionInfo.effectiveDateStart"/>
                                                                       <span class="input-group-btn">
                                                                       <button type="button" class="btn btn-default" ng-click="openDatePicker($event, 'promotionEffectiveTimeEnd')"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                       </span>
                                                                </div>
                                                            </div>
                                                            <va-check ng-show="formPromotionInfo.txtPromotionEffectiveTimeStart.$error.required || formPromotionInfo.txtPromotionEffectiveTimeEnd.$error.required" check-type="required"></va-check>
                                                            <va-check ng-show="!formPromotionInfo.txtPromotionEffectiveTimeStart.$error.required && !formPromotionInfo.txtPromotionEffectiveTimeEnd.$error.required && (formPromotionInfo.txtPromotionEffectiveTimeStart.$error.date || formPromotionInfo.txtPromotionEffectiveTimeEnd.$error.date)" check-type="date"></va-check>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label" translate="CMS_TXT_PRODUCT_SELECTION_OVER"></label>
                                                        <div class="col-sm-8">
                                                            <div class="onoffswitch">
                                                                <input type="checkbox" name="promotionisSelectionOver" class="onoffswitch-checkbox" id="promotionisSelectionOver" ng-model="promotionInfo.isSelectionOver" ng-change="promotionChanged()">
                                                                <label class="onoffswitch-label" for="promotionisSelectionOver">
                                                                    <span class="onoffswitch-inner"></span>
                                                                    <span class="onoffswitch-switch"></span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label" translate="CMS_TXT_ACTIVITY_CONFIRM_OVER"></label>
                                                        <div class="col-sm-8">
                                                            <div class="onoffswitch">
                                                                <input type="checkbox" name="promotionisSignUpOver" class="onoffswitch-checkbox" id="promotionisSignUpOver" ng-model="promotionInfo.isSignUpOver" ng-change="promotionChanged()">
                                                                <label class="onoffswitch-label" for="promotionisSignUpOver">
                                                                    <span class="onoffswitch-inner"></span>
                                                                    <span class="onoffswitch-switch"></span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label" translate="CMS_TXT_LOCATION_STOCK_OVER"></label>
                                                        <div class="col-sm-8">
                                                            <div class="onoffswitch">
                                                                <input type="checkbox" name="promotionisIsolationStockOver" class="onoffswitch-checkbox" id="promotionisIsolationStockOver" ng-model="promotionInfo.isIsolationStockOver" ng-change="promotionChanged()">
                                                                <label class="onoffswitch-label" for="promotionisIsolationStockOver">
                                                                    <span class="onoffswitch-inner"></span>
                                                                    <span class="onoffswitch-switch"></span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label class="col-sm-4 control-label"translate="CMS_TXT_ACTIVITY_OVER"></label>
                                                        <div class="col-sm-8">
                                                            <div class="onoffswitch">
                                                                <input type="checkbox" name="promotionisActivityOver" class="onoffswitch-checkbox" id="promotionisActivityOver" ng-model="promotionInfo.isActivityOver" ng-change="promotionChanged()">
                                                                <label class="onoffswitch-label" for="promotionisActivityOver">
                                                                    <span class="onoffswitch-inner"></span>
                                                                    <span class="onoffswitch-switch"></span>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div><!-- .col -->

                                                <div class="col-sm-12 control-savebar" ng-if="prmotionIsChanged && promotionInfo.isEffective">
                                                    <div class="col-sm-12 text-center">
                                                        <div class="form-group">
                                                            <button type="button" class="btn btn-default" translate="CMS_BTN_CANCEL" data-ng-click="undoUpdatePromotionInfo()"></button>
                                                            <button type="button" class="btn btn-vo" ng-disabled="formPromotionInfo.$invalid" translate="CMS_BTN_SAVE" data-ng-click="doUpdatePromotionInfo()"></button>
                                                        </div>
                                                    </div>
                                                </div><!-- .col -->
                                            </form>
                                        </div>
                                    </tab>
                                </tabset>
                            </div>
                            <!-- / tab -->
                        </accordion-group>
                    </accordion><!-- .accordion -->
                </div><!-- accordion ng-controller -->
                <div ng-if="promotionType === '1' || promotionType === '2'">
                    <accordion class="vo_accordion vo_attr" close-others="oneAtATime">
                        <accordion-group>
                            <accordion-heading>{{promotionName}}</accordion-heading>
                            <!-- effective toggle -->
                        </accordion-group>
                    </accordion><!-- .accordion -->
                </div>
            </div><!-- .col-lg-12 -->

            <div class="col-lg-12" >
                <div >
                    <tabset class="tab-container vo_nav-tabs">
                        <tab ng-if="promotionType != '3'">
                            <tab-heading><i class="glyphicon glyphicon-tags"></i>&nbsp;<span translate="CMS_TXT_SUB_PROMOTIONS"></span></tab-heading>
                            <!-- Models table and controls -->
                            <div class="panel vo_panel tab_panel">

                                <div class="table-responsive">
                                    <table datatable="ng" class="table table-striped hover b-t b-b vo_table">
                                        <thead>
                                        <tr>
                                            <th>
                                                <label class="i-checks-sm m-b-none">
                                                    <input type="checkbox"><i></i>
                                                </label>
                                            </th>
                                            <th translate="CMS_TXT_NAME"></th>
                                            <th translate="CMS_TXT_CART"></th>
                                            <th translate="CMS_TXT_PREHEAT_DATE"></th>
                                            <th translate="CMS_TXT_EFFECTIVE_DATE"></th>
                                            <th translate="CMS_TXT_ATTACHMENT_NAME"></th>
                                            <th translate="CMS_TXT_COMMENT"></th>
                                            <th translate="CMS_TXT_PRODUCT_SELECTION_OVER"></th>
                                            <th translate="CMS_TXT_ACTIVITY_CONFIRM_OVER"></th>
                                            <th translate="CMS_TXT_LOCATION_STOCK_OVER"></th>
                                            <th translate="CMS_TXT_ACTIVITY_OVER"></th>
                                            <th translate="CMS_TXT_CREATED_ON"></th>
                                            <th translate="CMS_TXT_LAST_UPDATED_ON"></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="subPromotion in subPromotionList">
                                            <td class="wtab-check"><label class="i-checks-sm m-b-none"><input type="checkbox" name="post[]"><i></i></label></td>
                                            <td class="wtab-xsm" ng-controller="navigationController"><a href="" class="btn-main" ng-bind="subPromotion.name" ng-href="{{goPromotionPage('3', subPromotion.promotionId)}}"></a></td>
                                            <td class="wtab-xs" ng-bind="subPromotion.cart"></td>
                                            <td class="wtab-sm" ng-bind="subPromotion.preheatDate"></td>
                                            <td class="wtab-sm" ng-bind="subPromotion.effectiveDate"></td>
                                            <td class="wtab-xsm" ng-bind="subPromotion.attachment" title="{{subPromotion.attachment}}"></td>
                                            <td class="wtab-xsm" ng-bind="subPromotion.comment" title="{{subPromotion.comment}}"></td>
                                            <td class="wtab-xs text-center"><input type="checkbox" ng-model="subPromotion.isSelectionOver"></td>
                                            <td class="wtab-xs text-center"><input type="checkbox" ng-model="subPromotion.isSignUpOver"></td>
                                            <td class="wtab-xs text-center"><input type="checkbox" ng-model="subPromotion.isIsolationStockOver"></td>
                                            <td class="wtab-xs text-center"><input type="checkbox" ng-model="subPromotion.isActivityOver"></td>
                                            <td class="wtab-sm" ng-bind="subPromotion.created"></td>
                                            <td class="wtab-sm" ng-bind="subPromotion.modified"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div><!-- .table-responsive -->
                            </div> <!-- .panel -->
                        </tab>

                        <tab ng-if="promotionType == '3'">
                            <tab-heading><i class="glyphicons glyphicons-sort"></i>&nbsp;<span translate="CMS_TXT_PRODUCTS"></span></tab-heading>
                            <!-- Products table and controls -->
                            <div class="panel vo_panel tab_panel"  >
                                <div class="row wrapper">
                                    <div class="col-sm-5 m-b-xs">
                                        <div class="btn-group dropdown" dropdown="">
                                            <button class="btn btn-vo" dropdown-toggle="" aria-haspopup="true" aria-expanded="false"><i class="fa fa-edit"></i>&nbsp;<span translate="CMS_BTN_BATCH_EDIT"></span>&nbsp;<span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu" ng-controller="cmsPopupController">
                                                <li><a href="" translate="CMS_BTN_DISCOUNT_SETTING" ng-click="openPromotionDiscount()"></a></li>
                                                <li><a href="" translate="CMS_BTN_DELETE" ng-click="doDeletePromotionProduct()"></a></li>
                                                <li><a href="" translate="CMS_BTN_ADD_TO_PROMOTION" ng-click = "openAddToPromotion(usProductInfo.selectIdList)"></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div><!-- .row wrapper -->

                                <div class="table-responsive"> 
                                     <table datatable dt-instance="dtPromotionProductList.dtInstance" dt-options="dtPromotionProductList.options" dt-columns="dtPromotionProductList.columns" class="table table-striped hover b-t b-b vo_table">
                                    </table>
                                </div><!-- .table-responsive -->
                            </div> <!-- .panel -->
                        </tab>
                    </tabset><!-- tabset -->
                </div><!-- tabs ng-controller -->
            </div><!-- .col-lg-12 -->

        </div><!-- .row -->
    </div><!-- end .wrapper-md -->
</div>