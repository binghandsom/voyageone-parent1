<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.voyageone.cms.sql">

    <resultMap id="resultMap_vtm" type="com.voyageone.task2.cms.model.CmsBtFeedInfoVtmModel">
        <result column="category" property="category" />
        <result column="channel_id" property="channelId" />
        <result column="m_product_type" property="sizeType" />
        <result column="m_brand" property="brand" />
        <result column="m_model" property="model" />
        <result column="p_name" property="name" />
        <result column="pe_short_description" property="short_description" />
        <result column="pe_long_description" property="long_description" />
        <result column="m_size_type" property="sizeType" />
        <result column="m_weight" property="weight" />
        <result column="p_code" property="code" />
        <result column="p_color" property="color" />
        <result column="p_made_in_country" property="origin" />
        <result column="EAN" property="EAN"/>
        <result column="MPN" property="MPN"/>
        <result column="Manufacturer" property="Manufacturer"/>
        <result column="Product Margin" property="ProductMargin"/>
        <result column="Buy It Now Price" property="BuyItNowPrice"/>
        <result column="Retail Price" property="RetailPrice"/>
        <result column="Relationship Name" property="RelationshipName"/>
        <result column="Classification" property="Classification"/>
        <result column="Amazon US ASIN" property="AmazonUSASIN"/>
        <result column="Base Size" property="BaseSize"/>
        <result column="Brand2" property="Brand2"/>
        <result column="Casin Free" property="CasinFree"/>
        <result column="COLOUR" property="COLOUR"/>
        <result column="CONDITION" property="CONDITION"/>
        <result column="Country of Origin" property="CountryofOrigin"/>
        <result column="Dairy Free" property="DairyFree"/>
        <result column="Dosage Size" property="DosageSize"/>
        <result column="Dosage Units" property="DosageUnits"/>
        <result column="Dropship" property="Dropship"/>
        <result column="Eco Friendly" property="EcoFriendly"/>
        <result column="Egg Free" property="EggFree"/>
        <result column="Generic Flavor" property="GenericFlavor"/>
        <result column="Gluten Free" property="GlutenFree"/>
        <result column="Hypo Allergenic" property="HypoAllergenic"/>
        <result column="Ingredients Text" property="IngredientsText"/>
        <result column="Is Item MAP" property="IsItemMAP"/>
        <result column="Item Categ Buyer Group" property="ItemCategBuyerGroup"/>
        <result column="Item Name" property="ItemName"/>
        <result column="Keywords" property="Keywords"/>
        <result column="Kosher" property="Kosher"/>
        <result column="Lactose Free" property="LactoseFree"/>
        <result column="Low Carb" property="LowCarb"/>
        <result column="Lowest Available Price" property="LowestAvailablePrice"/>
        <result column="MAP Price" property="MAPPrice"/>
        <result column="Marketing Description" property="MarketingDescription"/>
        <result column="MSRP" property="MSRP"/>
        <result column="No Animal Testing" property="NoAnimalTesting"/>
        <result column="Normal Selling Price" property="NormalSellingPrice"/>
        <result column="Nut Free" property="NutFree"/>
        <result column="Organic" property="Organic"/>
        <result column="Paraben Free" property="ParabenFree"/>
        <result column="Potency Size" property="PotencySize"/>
        <result column="Potency Units" property="PotencyUnits"/>
        <result column="Primary Image" property="PrimaryImage"/>
        <result column="Product ID" property="ProductID"/>
        <result column="Product Margin Percentage" property="ProductMarginPercentage"/>
        <result column="Product Rating" property="ProductRating"/>
        <result column="Product URL" property="ProductURL"/>
        <result column="Restricted" property="Restricted"/>
        <result column="Sale Price" property="SalePrice"/>
        <result column="Scent" property="Scent"/>
        <result column="Secondary Categories" property="SecondaryCategories"/>
        <result column="Secondary Images" property="SecondaryImages"/>
        <result column="Servings" property="Servings"/>
        <result column="Shipping Surcharge" property="ShippingSurcharge"/>
        <result column="Soy Free" property="SoyFree"/>
        <result column="Specific Color" property="SpecificColor"/>
        <result column="Specific Flavor" property="SpecificFlavor"/>
        <result column="Sugar Free" property="SugarFree"/>
        <result column="Suggested Use" property="SuggestedUse"/>
        <result column="Taxable" property="Taxable"/>
        <result column="Variant ID" property="VariantID"/>
        <result column="Vegetarian" property="Vegetarian"/>
        <result column="Warnings" property="Warnings"/>
        <result column="Wheat Free" property="WheatFree"/>
        <result column="Height" property="Height"/>
        <result column="Length" property="Length"/>
        <result column="Width" property="Width"/>
        <result column="Seller Cost" property="SellerCost"/>
        <result column="VoyageOne Price" property="VoyageOnePrice"/>
        <result column="Quantity" property="Quantity"/>
        <result column="VoyageOne MSRP" property="VoyageOneMSRP"/>
        <collection property="skus" javaType="ArrayList" ofType="com.voyageone.service.model.cms.mongo.feed.CmsBtFeedInfoModel_Sku" >
            <result column="i_sku" property="sku" />
            <result column="i_size" property="size" />
            <result column="i_barcode" property="barcode" />
            <result column="i_client_sku" property="clientSku" />
            <result column="p_msrp" property="price_msrp" />
            <result column="cps_cn_price_rmb" property="price_current" />
        </collection>
        <collection property="image" javaType="ArrayList" ofType="String" >
            <result column="image" property="image" />
        </collection>
    </resultMap>
    <select id="cms_vtmfeed_select" resultMap="resultMap_vtm" parameterType="HashMap">
        select
        ${category} as category
        ,#{channel_id} as channel_id
        ,${m_product_type} as m_product_type
        ,${m_brand} as m_brand
        ,${m_model} as m_model
        ,${m_name} as m_name
        ,${m_size_type} as m_size_type
        ,${m_weight} as m_weight
        ,${p_code} as p_code
        ,${p_name} as p_name
        ,${p_color} as p_color
        ,${p_msrp} as p_msrp
        ,${p_made_in_country} as p_made_in_country
        ,${pe_short_description} as pe_short_description
        <if test="p_product_type != null">
            ,${p_product_type} as p_product_type
        </if>
        ,${pe_long_description} as pe_long_description
        ,${cps_cn_price_rmb}  as cps_cn_price_rmb
        ,${i_sku} as i_sku
        ,CONCAT(#{channel_id},'-',${i_itemcode}) as i_itemcode
        ,${i_size} as i_size
        ,${i_barcode} as i_barcode
        ,${i_client_sku} as i_client_sku
        ,1 as i_active
        ,${image} as image
        ,1 as image_type
        ,0 as display_order
        ,`EAN`
        ,`MPN`
        ,`Manufacturer`
        ,`Product Margin`
        ,`Buy It Now Price`
        ,`Retail Price`
        ,`Relationship Name`
        ,`Classification`
        ,`Amazon US ASIN`
        ,`Base Size`
        ,`Brand2`
        ,`Casin Free`
        ,`COLOUR`
        ,`CONDITION`
        ,`Country of Origin`
        ,`Dairy Free`
        ,`Dosage Size`
        ,`Dosage Units`
        ,`Dropship`
        ,`Eco Friendly`
        ,`Egg Free`
        ,`Generic Flavor`
        ,`Gluten Free`
        ,`Hypo Allergenic`
        ,`Ingredients Text`
        ,`Is Item MAP`
        ,`Item Categ Buyer Group`
        ,`Item Name`
        ,`Keywords`
        ,`Kosher`
        ,`Lactose Free`
        ,`Low Carb`
        ,`Lowest Available Price`
        ,`MAP Price`
        ,`Marketing Description`
        ,`MSRP`
        ,`No Animal Testing`
        ,`Normal Selling Price`
        ,`Nut Free`
        ,`Organic`
        ,`Paraben Free`
        ,`Potency Size`
        ,`Potency Units`
        ,`Primary Image`
        ,`Product ID`
        ,`Product Margin Percentage`
        ,`Product Rating`
        ,`Product URL`
        ,`Restricted`
        ,`Sale Price`
        ,`Scent`
        ,`Secondary Categories`
        ,`Secondary Images`
        ,`Servings`
        ,`Shipping Surcharge`
        ,`Soy Free`
        ,`Specific Color`
        ,`Specific Flavor`
        ,`Sugar Free`
        ,`Suggested Use`
        ,`Taxable`
        ,`Variant ID`
        ,`Vegetarian`
        ,`Warnings`
        ,`Wheat Free`
        ,`Height`
        ,`Length`
        ,`Width`
        ,`Seller Cost`
        ,`VoyageOne Price`
        ,`Quantity`
        ,`VoyageOne MSRP`
        from
        ${tableName}
        ${keyword}
    </select>

    <update id="cms_zz_worktable_vtm_superfeed_full_update">
        UPDATE voyageone_cms2.cms_zz_worktable_vtm_superfeed_full set UpdateFlag = 0
    </update>

    <update id="cms_zz_worktable_vtm_superfeed_update"  parameterType="java.util.List">
        UPDATE voyageone_cms2.cms_zz_worktable_vtm_superfeed set UpdateFlag = 3 where UpdateFlag = 1 and `SKU` in (
        <foreach collection="list" item="itemIds" index="index" separator=",">
            #{itemIds}
        </foreach>
        )
    </update>

    <insert id="cms_zz_worktable_vtm_superfeed_full_insert"  parameterType="java.util.List">
        INSERT INTO voyageone_cms2.cms_zz_worktable_vtm_superfeed_full SELECT * from
        voyageone_cms2.cms_zz_worktable_vtm_superfeed where `SKU` in
        (
        <foreach collection="list" item="itemIds" index="index" separator=",">
            #{itemIds}
        </foreach>
        )
    </insert>

    <delete id="cms_zz_worktable_vtm_superfeed_full_del" parameterType="java.util.List">
        DELETE
        FROM
        voyageone_cms2.cms_zz_worktable_vtm_superfeed_full
        where `SKU` in (
        <foreach collection="list" item="itemIds" index="index" separator=",">
            #{itemIds}
        </foreach>
        )
    </delete>
</mapper>