<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.voyageone.security.daoext.ComUserDaoExt" >
    <resultMap type="com.voyageone.security.bean.ComChannelPermissionBean" id="ctUserChannelPermissionMap">
        <result column="channel_id" property="channelId"/>
        <result column="full_name" property="channelName"/>
        <result column="img_url" property="channelImgUrl"/>
        <result column="company_id" property="companyId"/>
        <result column="company" property="companyName"/>
        <collection property="apps" javaType="List" ofType="Map">
            <result column="application" property="application"/>
            <result column="application_id" property="applicationId"/>
        </collection>
    </resultMap>

    <select id="selectPermissionChannel" resultMap="ctUserChannelPermissionMap" >
        SELECT DISTINCT (res_name) AS application , r.application_id , c.order_channel_id as channel_id ,c.full_name,c.img_url,c.company_id, co.company
        from view_user_res r, Synship.tm_order_channel c  , Synship.ct_company co
        where res_type = 0  and r.channel_id = c.order_channel_id and c.company_id = co.id
        and r.channel_id &lt;&gt; 'ALL'
        and r.active = 1
        and c.active = 1
        and co.active = 1
        and user_id =  #{userId,jdbcType=INTEGER}
        UNION
        SELECT DISTINCT (res_name) AS application , r.application_id , c.order_channel_id as channel_id ,c.full_name,c.img_url,c.company_id, co.company
        from view_user_res r, Synship.tm_order_channel c  , Synship.ct_company co
        where res_type = 0  and c.company_id = co.id
        and r.channel_id = 'ALL'
        and r.active = 1
        and c.active = 1
        and co.active = 1
        and user_id =  #{userId,jdbcType=INTEGER}


    </select>

    <select id="getPermissionUrls" resultType="java.lang.String">
        SELECT DISTINCT res_url  from view_user_res
        where res_type = 2 AND active = 1
        and user_id =  #{userId,jdbcType=INTEGER}
        and channel_id =  #{channelId,jdbcType=VARCHAR}
        and application =  #{application,jdbcType=VARCHAR}
    </select>


</mapper>