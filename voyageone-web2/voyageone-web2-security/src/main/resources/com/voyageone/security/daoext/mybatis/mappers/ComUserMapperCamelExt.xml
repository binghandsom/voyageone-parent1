<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.voyageone.security.daoext.ComUserDaoExt" >
    <resultMap type="com.voyageone.security.bean.ComChannelPermissionBean" id="ctUserChannelPermissionMap">
        <result column="channel_id" property="channelId"/>
        <result column="full_name" property="channelName"/>
        <result column="img_url" property="channelImgUrl"/>
        <result column="company_id" property="companyId"/>
        <result column="company" property="companyName"/>
        <collection property="apps" javaType="List" ofType="Map">
            <result column="application" property="application"/>
            <result column="application_id" property="applicationId"/>
        </collection>
    </resultMap>

    <select id="selectPermissionChannel" resultMap="ctUserChannelPermissionMap" >
        SELECT
            re.application,
            ap.id AS application_id,
            re.channel_id,
            re.full_name,
            re.img_url,
            re.company_id,
            re.company
        FROM
            view_user_application re,
            synship.ct_application ap
        WHERE
        ap.application = re.application
        AND user_id =  #{userId,jdbcType=INTEGER}
    </select>

    <select id="getPermissionUrls" resultType="java.lang.String">
        SELECT DISTINCT res_url  from view_res_user_company
        where res_type = 2 AND active = 1
        and user_id =  #{userId,jdbcType=INTEGER}
        and channel_id =  #{channelId,jdbcType=VARCHAR}
        and application =  #{application,jdbcType=VARCHAR}
    </select>

    <select id="selectRolesByUserId" resultType="com.voyageone.security.model.ComRoleModel">
        SELECT r.* from com_role r , com_user_role ur, com_user u
        WHERE r.id = ur.role_id AND ur.user_id = u.id
        AND r.active =1
        AND user_id =  #{userId,jdbcType=INTEGER}
    </select>

</mapper>