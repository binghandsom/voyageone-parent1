<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.voyageone.web2.cms.sql">
    <resultMap id="PromotionMap" type="com.voyageone.web2.cms.model.CmsBtPromotionModel" >
        <id column="promotion_id" property="promotionId" jdbcType="INTEGER" />
        <result column="channel_id" property="channelId" jdbcType="VARCHAR" />
        <result column="cart_id" property="cartId" jdbcType="INTEGER" />
        <result column="promotion_status" property="promotionStatus" jdbcType="BOOLEAN"/>
        <result column="is_active" property="isActive" jdbcType="BOOLEAN"/>
        <result column="ref_tag_id" property="refTagId" jdbcType="INTEGER"/>
        <result column="promotion_name" property="promotionName" jdbcType="VARCHAR" />
        <result column="pre_period_start" property="prePeriodStart" jdbcType="VARCHAR" />
        <result column="pre_period_end" property="prePeriodEnd" jdbcType="VARCHAR" />
        <result column="pre_sale_start" property="preSaleStart" jdbcType="VARCHAR" />
        <result column="pre_sale_end" property="preSaleEnd" jdbcType="VARCHAR" />
        <result column="activity_start" property="activityStart" jdbcType="VARCHAR" />
        <result column="activity_end" property="activityEnd" jdbcType="VARCHAR" />
        <result column="tejiabao_id" property="tejiabaoId" jdbcType="VARCHAR" />
        <result column="promotion_type" property="promotionType" jdbcType="VARCHAR" />
        <result column="created" property="created" jdbcType="TIMESTAMP" />
        <result column="creater" property="creater" jdbcType="VARCHAR" />
        <result column="modified" property="modified" jdbcType="TIMESTAMP" />
        <result column="modifier" property="modifier" jdbcType="VARCHAR" />
        <result column="cartName" property="cartName" jdbcType="VARCHAR" />
    </resultMap>
    <select id="select_promotion_list" resultMap="PromotionMap" parameterType="HashMap" >
        select
              a.promotion_id,
              a.channel_id,
              a.cart_id,
              a.promotion_status,
              a.promotion_name,
              a.pre_period_start,
              a.pre_period_end,
              a.pre_sale_start,
              a.pre_sale_end,
              a.activity_start,
              a.activity_end,
              a.tejiabao_id,
              a.promotion_type,
              a.is_active,
              a.ref_tag_id,
              a.created,
              a.creater,
              a.modified,
              a.modifier,
              b.name as cartName
        from voyageone_cms2.cms_bt_promotion a left join ct_cart b on a.cart_id = b.cart_id
        where
            a.is_active = 1
          <if test="channelId != null and channelId != ''">
              and a.channel_id = #{channelId}
          </if>
          <if test="promotionId != null and promotionId != ''">
            and a.promotion_id = #{promotionId}
          </if>
          <if test="promotionName != null and promotionName != ''">
              and a.promotion_name LIKE '%${promotionName}%'
          </if>
        <if test="cartId != null and cartId != ''">
            and a.cart_id = #{cartId,jdbcType=INTEGER}
        </if>
        <if test="promotionType != null and promotionType != ''" >
           and a.promotion_type =  #{promotionType,jdbcType=VARCHAR}
        </if>
        <if test="createdStart != null and createdStart != ''">
            and a.created >=   #{createdStart,jdbcType=VARCHAR}
        </if>
        <if test="createdEnd != null and createdEnd != ''">
            and  #{createdEnd,jdbcType=VARCHAR} >=  a.created
        </if>
    </select>
    <insert id="insert_promotion" parameterType="com.voyageone.web2.cms.model.CmsBtPromotionModel" >
        insert into voyageone_cms2.cms_bt_promotion
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="channelId != null" >
                channel_id,
            </if>
            <if test="cartId != null" >
                cart_id,
            </if>
            <if test="promotionName != null" >
                promotion_name,
            </if>
            <if test="preSaleStart != null" >
                pre_sale_start,
            </if>
            <if test="preSaleEnd != null" >
                pre_sale_end,
            </if>
            <if test="prePeriodStart != null" >
                pre_period_start,
            </if>
            <if test="prePeriodEnd != null" >
                pre_period_end,
            </if>
            <if test="activityStart != null" >
                activity_start,
            </if>
            <if test="activityEnd != null" >
                activity_end,
            </if>
            <if test="tejiabaoId != null" >
                tejiabao_id,
            </if>
            <if test="promotionType != null" >
                promotion_type,
            </if>
            <if test="refTagId != null">
                ref_tag_id,
            </if>
                created,
            <if test="creater != null" >
                creater,
            </if>
                modified,
            <if test="creater != null" >
                modifier,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="channelId != null" >
                #{channelId,jdbcType=VARCHAR},
            </if>
            <if test="cartId != null" >
                #{cartId,jdbcType=INTEGER},
            </if>
            <if test="promotionName != null" >
                #{promotionName,jdbcType=VARCHAR},
            </if>
            <if test="preSaleStart != null" >
                #{preSaleStart,jdbcType=VARCHAR},
            </if>
            <if test="preSaleEnd != null" >
                #{preSaleEnd,jdbcType=VARCHAR},
            </if>
            <if test="prePeriodStart != null" >
                #{prePeriodStart,jdbcType=VARCHAR},
            </if>
            <if test="prePeriodEnd != null" >
                #{prePeriodEnd,jdbcType=VARCHAR},
            </if>
            <if test="activityStart != null" >
                #{activityStart,jdbcType=VARCHAR},
            </if>
            <if test="activityEnd != null" >
                #{activityEnd,jdbcType=VARCHAR},
            </if>
            <if test="tejiabaoId != null" >
                #{tejiabaoId,jdbcType=VARCHAR},
            </if>
            <if test="promotionType != null" >
                #{promotionType,jdbcType=VARCHAR},
            </if>
            <if test="refTagId != null">
                #{refTagId,jdbcType=INTEGER},
            </if>
                now(),
            <if test="creater != null" >
                #{creater,jdbcType=VARCHAR},
            </if>
                now(),
            <if test="creater != null" >
                #{creater,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="update_promotion" parameterType="com.voyageone.web2.cms.model.CmsBtPromotionModel" >
        update voyageone_cms2.cms_bt_promotion
        <set >
            <if test="channelId != null" >
                channel_id = #{channelId,jdbcType=VARCHAR},
            </if>
            <if test="cartId != null" >
                cart_id = #{cartId,jdbcType=INTEGER},
            </if>
            <if test="promotionName != null" >
                promotion_name = #{promotionName,jdbcType=VARCHAR},
            </if>
            <if test="preSaleStart != null" >
                pre_sale_start = #{preSaleStart,jdbcType=VARCHAR},
            </if>
            <if test="preSaleEnd != null" >
                pre_sale_end = #{preSaleEnd,jdbcType=VARCHAR},
            </if>
            <if test="prePeriodStart != null" >
                pre_period_start = #{prePeriodStart,jdbcType=VARCHAR},
            </if>
            <if test="prePeriodEnd != null" >
                pre_period_end = #{prePeriodEnd,jdbcType=VARCHAR},
            </if>
            <if test="activityStart != null" >
                activity_start = #{activityStart,jdbcType=VARCHAR},
            </if>
            <if test="activityEnd != null" >
                activity_end = #{activityEnd,jdbcType=VARCHAR},
            </if>
            <if test="tejiabaoId != null" >
                tejiabao_id = #{tejiabaoId,jdbcType=VARCHAR},
            </if>
            <if test="isActive != null">
                is_active = #{isActive,jdbcType=BOOLEAN},
            </if>
            <if test="promotionType != null" >
                promotion_type = #{promotionType,jdbcType=VARCHAR},
            </if>
                modified = now(),
            <if test="modifier != null" >
                modifier = #{modifier,jdbcType=VARCHAR},
            </if>
        </set>
        where promotion_id = #{promotionId,jdbcType=INTEGER}
    </update>
</mapper>
