<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.voyageone.web2.cms.sql">
    <select id="select_stock_separate_item" resultType="HashMap" parameterType="HashMap">
        select
            product_model,
            product_code,
            sku,
            cart_id,
            property1,
            property2,
            property3,
            property4,
            qty,
            separate_qty,
            status,
            t2.name as status_name
        from ${tableName} t1
        left outer join (select value,name from com_mt_value where type_id= '63' and lang_id = #{lang}) t2
        on t1.status = t2.value
        where task_id = #{taskId}
        <if test="sku !=null">
            and sku = #{sku}
        </if>
        <if test="skuList != null and skuList.size() > 0">
            and (sku in
            <foreach collection="skuList" item="sku" open="(" separator="," close=")">
                #{sku}
            </foreach>
            )
        </if>
        <if test="cartId !=null">
            and cart_id = #{cartId}
        </if>
        order by sku,cart_id
    </select>

    <select id="select_stock_separate_item_by_sql_object" resultType="Object" parameterType="HashMap">
        ${sql}
    </select>

    <select id="select_stock_separate_item_by_sql_map" resultType="HashMap" parameterType="HashMap">
        ${sql}
    </select>

    <select id="select_stock_separate_item_cnt" resultType="int" parameterType="HashMap">
         select count(*)
            from   voyageone_cms2.cms_bt_stock_separate_item
            where task_id = #{taskId}
            <if test="status !=null">
                and status = #{status}
            </if>
    </select>

    <select id="select_stock_separate_success_qty" resultType="Object" parameterType="HashMap">
        select sum(separate_qty)
        from   voyageone_cms2.cms_bt_stock_separate_item
        where sku = #{sku}
        and status = #{status}
        <if test="taskId !=null">
            and task_id = #{taskId}
        </if>
        <if test="cartId !=null">
            and cart_id = #{cartId}
        </if>
    </select>

    <select id="select_stock_separate_item_history_cnt" resultType="int" parameterType="HashMap">
         select count(*)
            from   voyageone_cms2.cms_bt_stock_separate_item_history
            where task_id = #{taskId}
          limit 0,1
    </select>

    <update id="update_stock_separate_item" parameterType="HashMap" >
        update voyageone_cms2.cms_bt_stock_separate_item
        <set >
            <if test="productModel != null" >
                product_model = #{productModel,jdbcType=VARCHAR},
            </if>
            <if test="productCode != null" >
                product_code = #{productCode,jdbcType=VARCHAR},
            </if>
            <if test="property1 != null" >
                property1 = #{property1,jdbcType=VARCHAR},
            </if>
            <if test="property2 != null" >
                property1 = #{property2,jdbcType=VARCHAR},
            </if>
            <if test="property3 != null" >
                property1 = #{property3,jdbcType=VARCHAR},
            </if>
            <if test="property4 != null" >
                property1 = #{property4,jdbcType=VARCHAR},
            </if>
            <if test="qty != null" >
                qty = #{qty,jdbcType=INTEGER},
            </if>
            <if test="separateQty != null" >
                separate_qty = #{separateQty,jdbcType=INTEGER},
            </if>
            <if test="errorMsg != null" >
                error_msg = #{errorMsg,jdbcType=VARCHAR},
            </if>
            <if test="errorTime != null" >
                error_time = #{errorTime,jdbcType=VARCHAR},
            </if>
            <if test="separateTime != null" >
                separate_time = #{separateTime,jdbcType=VARCHAR},
            </if>
            <if test="restoreTime != null" >
                restore_time = #{restoreTime,jdbcType=VARCHAR},
            </if>
            <if test="status != null" >
                status = #{status,jdbcType=VARCHAR},
            </if>
            modified = now(),
            <if test="modifier != null" >
                modifier = #{modifier,jdbcType=VARCHAR},
            </if>
        </set>
        <where>
            1 = 1
            <if test="seq != null" >
                and seq = #{seq,jdbcType=INTEGER}
            </if>
            <if test="taskId != null" >
                and task_id = #{taskId,jdbcType=INTEGER}
            </if>
            <if test="sku != null" >
                and sku = #{sku,jdbcType=VARCHAR}
            </if>
            <if test="cartId != null" >
                and cart_id = #{cartId,jdbcType=INTEGER}
            </if>
        </where>
    </update>

    <delete id="delete_stock_separate_item" parameterType="HashMap">
        delete
        from voyageone_cms2.cms_bt_stock_separate_item
        where
        task_id = #{taskId,jdbcType=INTEGER}
        <if test="sku != null" >
            and sku = #{sku,jdbcType=VARCHAR}
        </if>
        <if test="cartId != null" >
            and cart_id = #{cartId,jdbcType=INTEGER}
        </if>
    </delete>

</mapper>